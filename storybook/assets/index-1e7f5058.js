import{j as S}from"./jsx-runtime-9ef10904.js";import{r as d,R as A}from"./index-6c164b11.js";import{c as N,C as Z}from"./string-b39bd50e.js";import{u as $}from"./use-dom-ref-7c72e1a5.js";import{u as ee}from"./useId-133e3351.js";import{u as te,m as Y,a as ne}from"./index-a18291c8.js";import{N as U,a as ae}from"./NumberParser-89118490.js";const oe="_quantityToggleWrapper_1gg2q_7",se="_label_1gg2q_13",re="_asterix_1gg2q_22",le="_quantityToggle_1gg2q_7",ie="_quantityToggleInput_1gg2q_32",ue="_quantityToggleButton_1gg2q_37",ce="_quantityToggleHelperText_1gg2q_84",de="_quantityToggleWrapperIsDisabled_1gg2q_95",ge="_quantityToggleInputIsDisabled_1gg2q_99",fe="_quantityToggleButtonIsDisabled_1gg2q_104",me="_quantityToggleInputIsErrored_1gg2q_110",pe="_quantityToggleButtonIsErrored_1gg2q_115",ye="_quantityToggleIsErrored_1gg2q_119",be="_quantityToggleHelperTextIsErrored_1gg2q_129",q={quantityToggleWrapper:oe,label:se,asterix:re,quantityToggle:le,quantityToggleInput:ie,quantityToggleButton:ue,quantityToggleHelperText:ce,quantityToggleWrapperIsDisabled:de,quantityToggleInputIsDisabled:ge,quantityToggleButtonIsDisabled:fe,quantityToggleInputIsErrored:me,quantityToggleButtonIsErrored:pe,quantityToggleIsErrored:ye,quantityToggleHelperTextIsErrored:be};function Te(e,o){const{type:n="text",validationState:a,isDisabled:s=!1,isRequired:l=!1,isReadOnly:i=!1,onChange:t=()=>{}}=e,{focusableProps:r}=te(e,o);return{inputProps:Y(e,{type:n,pattern:e.pattern,disabled:s,readOnly:i,"aria-required":l||void 0,"aria-invalid":a==="invalid"||void 0,"aria-errormessage":e["aria-errormessage"],"aria-activedescendant":e["aria-activedescendant"],"aria-autocomplete":e["aria-autocomplete"],"aria-haspopup":e["aria-haspopup"],value:e.value,defaultValue:e.value?void 0:e.defaultValue,onChange:u=>t(u.target.value),autoComplete:e.autoComplete,maxLength:e.maxLength,minLength:e.minLength,name:e.name,placeholder:e.placeholder,inputMode:e.inputMode,onCopy:e.onCopy,onCut:e.onCut,onPaste:e.onPaste,onCompositionEnd:e.onCompositionEnd,onCompositionStart:e.onCompositionStart,onCompositionUpdate:e.onCompositionUpdate,onSelect:e.onSelect,onBeforeInput:e.onBeforeInput,onInput:e.onInput,...r})}}function X(){return typeof window<"u"&&window.InputEvent&&typeof InputEvent.prototype.getTargetRanges=="function"}function qe(e,o,n){const a=d.useRef(o);a.current=o,d.useEffect(()=>{if(!X())return;const t=n.current,r=u=>{const T=a.current;let c;switch(u.inputType){case"historyUndo":case"historyRedo":return;case"deleteContent":case"deleteByCut":case"deleteByDrag":c=t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd);break;case"deleteContentForward":c=t.selectionEnd===t.selectionStart?t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd+1):t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd);break;case"deleteContentBackward":c=t.selectionEnd===t.selectionStart?t.value.slice(0,t.selectionStart-1)+t.value.slice(t.selectionStart):t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd);break;case"deleteSoftLineBackward":case"deleteHardLineBackward":c=t.value.slice(t.selectionStart);break;default:u.data!=null&&(c=t.value.slice(0,t.selectionStart)+u.data+t.value.slice(t.selectionEnd));break}(c==null||!T.validate(c))&&u.preventDefault()};return t.addEventListener("beforeinput",r,!1),()=>{t.removeEventListener("beforeinput",r,!1)}},[n,a]);const s=X()?null:t=>{const r=t.target.value.slice(0,t.target.selectionStart)+t.data+t.target.value.slice(t.target.selectionEnd);o.validate(r)||t.preventDefault()},{inputProps:l}=Te(e,n),i=d.useRef(null);return{...Y(l,{onBeforeInput:s,onCompositionStart(){const{value:t,selectionStart:r,selectionEnd:u}=n.current;i.current={value:t,selectionStart:r,selectionEnd:u}},onCompositionEnd(){if(!o.validate(n.current.value)){const{value:t,selectionStart:r,selectionEnd:u}=i.current;n.current.value=t,n.current.setSelectionRange(r,u),o.setInputValue(t)}}})}}function Ie(e){const o=d.useRef(),{isReadOnly:n,onIncrement:a,onDecrement:s,onIncrementPage:l,onDecrementPage:i,onDecrementToMin:t,onIncrementToMax:r}=e,u=d.useRef(e);u.current=e;const T=()=>clearTimeout(o.current);d.useEffect(()=>()=>T(),[]);const c=f=>{if(!(f.ctrlKey||f.metaKey||f.shiftKey||f.altKey||n))switch(f.key){case"PageUp":l&&(f.preventDefault(),l());break;case"ArrowUp":case"Up":a&&(f.preventDefault(),a());break;case"PageDown":i&&(f.preventDefault(),i());break;case"ArrowDown":case"Down":s&&(f.preventDefault(),s());break;case"Home":t&&(f.preventDefault(),t());break;case"End":r&&(f.preventDefault(),r());break}},m=d.useRef(!1);return{onKeyDown:c,onFocus:()=>{m.current=!0},onBlur:()=>{m.current=!1}}}function he(e={}){return d.useMemo(()=>new U("en-US",e),[e])}function ve(e,o,n,a){d.useEffect(()=>{const s=e.current;return s&&n!==null&&s.addEventListener(o,n,a),()=>{s&&n!==null&&s.removeEventListener(o,n,a)}},[e,o,a,n])}function xe(e,o){const{onScroll:n,isDisabled:a}=e,s=d.useCallback(l=>{const i=l;i.ctrlKey||(i.preventDefault(),i.stopPropagation(),n&&n({deltaX:i.deltaX,deltaY:i.deltaY}))},[n]);ve(o,"wheel",a?null:s,{passive:!1})}function De(e,o,n){const{label:a,description:s,errorMessage:l,formatOptions:i,autoFocus:t=!1,isRequired:r=!1,isReadOnly:u=!1,isDisabled:T=!1,maxValue:c=1/0,minValue:m=-1/0,disableScroll:p=!0,validationState:I="valid",onBlur:f=()=>{},onKeyUp:M=()=>{},onFocus:E=()=>{},onKeyDown:B=()=>{},onFocusChange:x=()=>{},...b}=e,{inputValue:P,numberValue:V,commit:F,increment:y,decrement:D,incrementToMax:O,decrementToMin:R}=o,{focusProps:j}=ne({onBlur:()=>F()}),k=he({...i,currencySign:void 0}),L=d.useMemo(()=>isNaN(V)?"":k.format(V),[k,V]),H=Ie({maxValue:c,minValue:m,textValue:L,isRequired:r,isReadOnly:u,isDisabled:T,value:V,onIncrement:y,onDecrement:D,onIncrementToMax:O,onDecrementToMin:R}),W=d.useCallback(v=>{Math.abs(v.deltaY)<=Math.abs(v.deltaX)||(v.deltaY>0?y():v.deltaY<0&&D())},[D,y]);xe({onScroll:W,isDisabled:T||u||p},n);const g=qe({...b,label:a,autoFocus:t,isReadOnly:u,isRequired:r,isDisabled:T,description:s,errorMessage:l,type:"text",validationState:I,defaultValue:"",value:P,autoComplete:"off",inputMode:"numeric",onBlur:f,onFocus:E,onKeyUp:M,onChange:v=>{o.setInputValue(v)},onKeyDown:B,onFocusChange:x},o,n),h=Y(H,j,g,{autoCorrect:"off"}),_=()=>{var v;document.activeElement!==n.current&&((v=n.current)==null||v.focus())},w={"aria-label":"increase",slot:"increment",type:"button",tabIndex:-1,disabled:!o.canIncrement,onClick:()=>{_(),y()},onMouseDown:v=>v.preventDefault()},J={"aria-label":"decrease",slot:"decrement",type:"button",tabIndex:-1,disabled:!o.canDecrement,onClick:()=>{_(),D()},onMouseDown:v=>v.preventDefault()};return delete h.isErrored,delete h.isReadOnly,delete h.isRequired,delete h.isDisabled,delete h.helperText,delete h.defaultValue,delete h.errorMessage,delete h.validationState,delete h.onUpdate,delete h.onFocusChange,{inputProps:h,incrementButtonProps:w,decrementButtonProps:J}}function Se(e,o=-1/0,n=1/0){return Math.min(Math.max(e,o),n)}function C(e,o,n,a){const s=(e-(o||0))%a;let l=Math.abs(s)*2>=a?e+Math.sign(s)*(a-Math.abs(s)):e-s;o?l<o?l=o:n&&l>n&&(l=o+Math.floor((n-o)/a)*a):n&&l>n&&(l=Math.floor(n/a)*a);const i=a.toString(),t=i.indexOf("."),r=t>=0?i.length-t:0;if(r>0){const u=Math.pow(10,r);l=Math.round(l*u)/u}return l}function Ee(e,o,n){const[a,s]=d.useState(e??o),l=d.useRef(e!==void 0),i=e!==void 0,t=d.useRef(a);l.current=i;const r=d.useCallback((u,...T)=>{const c=(m,...p)=>{n&&(Object.is(t.current,m)||n(m,...p)),i||(t.current=m)};typeof u=="function"?s((p,...I)=>{const f=u(i?t.current:p,...I);return c(f,...T),i?p:f}):(i||s(u),c(u,...T))},[i,n]);return i?t.current=e:e=a,[e,r]}function _e(e){const{step:o,value:n,minValue:a,maxValue:s,isReadOnly:l,isDisabled:i,defaultValue:t,formatOptions:r,locale:u="en-US",onChange:T}=e,[c,m]=Ee(n,t&&isNaN(t)?NaN:t,T),[p,I]=d.useState(()=>isNaN(c)?"":new U(u,r).format(c)),f=d.useMemo(()=>new ae(u,r),[u,r]),M=d.useMemo(()=>f.getNumberingSystem(p),[f,p]),E=d.useMemo(()=>new U(u,{...r,numberingSystem:M}),[u,r,M]),B=d.useMemo(()=>E.resolvedOptions(),[E]),x=d.useCallback(g=>isNaN(g)||g===null?"":E.format(g),[E]);let b=o||1;B.style==="percent"&&!o&&(b=.01);const P=d.useRef(c),V=d.useRef(u),F=d.useRef(r);(!Object.is(c,P.current)||u!==V.current||r!==F.current)&&(I(x(c)),P.current=c,V.current=u,F.current=r);const y=d.useMemo(()=>f.parse(p),[f,p]),D=d.useRef(0);D.current=y;const O=()=>{if(!p.length){m(NaN),I(n===void 0?"":x(c));return}if(isNaN(D.current)){I(x(c));return}let g;o?g=C(D.current,a,s,o):g=Se(D.current,a,s),g=f.parse(x(g)),m(g),I(x(n===void 0?g:c))},R=(g,h)=>{const _=D.current;if(isNaN(_))return C(h||0,a,s,b);{const w=C(_,a,s,b);return g==="+"&&w>_||g==="-"&&w<_?w:C(K(g,_,b),a,s,b)}},j=()=>{const g=R("+",a);g===c&&I(x(g)),m(g)},k=()=>{const g=R("-",s);g===c&&I(x(g)),m(g)},L=()=>{s!=null&&m(C(s,a,s,b))},H=()=>{a!=null&&m(a)},W=d.useMemo(()=>!i&&!l&&(isNaN(y)||!s||C(y,a,s,b)>y||K("+",y,b)<=s),[i,l,a,s,b,y]),Q=d.useMemo(()=>!i&&!l&&(isNaN(y)||!a||C(y,a,s,b)<y||K("-",y,b)>=a),[i,l,a,s,b,y]);return{inputValue:p,canIncrement:W,canDecrement:Q,minValue:a??-1/0,maxValue:s??1/0,numberValue:y,commit:O,validate:g=>f.isValidPartialNumber(g,a,s),increment:j,decrement:k,setInputValue:I,incrementToMax:L,decrementToMin:H}}function K(e,o,n){let a=e==="+"?o+n:o-n;if(o%1!==0||n%1!==0){const s=o.toString().split("."),l=n.toString().split("."),i=s[1]&&s[1].length||0,t=l[1]&&l[1].length||0,r=Math.pow(10,Math.max(i,t));o=Math.round(o*r),n=Math.round(n*r),a=e==="+"?o+n:o-n,a/=r}return a}const z=A.forwardRef((e,o)=>{const{id:n,label:a,css:s={},onUpdate:l,className:i,isRequired:t,isErrored:r=!1,...u}=e,T=ee(n),c=$(o),m=_e(u),{inputProps:p,incrementButtonProps:I,decrementButtonProps:f}=De(e,m,c);A.useEffect(()=>{l==null||l(m.inputValue,m.numberValue)},[m.numberValue,m.inputValue,l]);const M=N(q.quantityToggleWrapper,!!p.disabled&&q.quantityToggleWrapperIsDisabled,i,"cdg-quantity-toggle"),E=N(q.quantityToggle,r&&q.quantityToggleIsErrored,"cdg-quantity-toggle-content"),B=N(q.quantityToggleInput,!!p.disabled&&q.quantityToggleInputIsDisabled,r&&q.quantityToggleInputIsErrored,"cdg-quantity-toggle-input"),x=N(q.quantityToggleButton,!!p.disabled&&q.quantityToggleButtonIsDisabled,r&&q.quantityToggleButtonIsErrored,"cdg-quantity-toggle-button"),b=N(q.quantityToggleHelperText,q.quantityToggleHelperTextIsErrored,"cdg-quantity-toggle-error-message");return S.jsx(Z,{css:s,children:S.jsxs("div",{className:M,children:[e.label&&S.jsxs("label",{htmlFor:T,className:N(q.label,"cdg-quantity-toggle-label"),children:[a,t&&S.jsx("span",{className:N(q.asterix,"cdg-quantity-toggle-asterix"),children:"*"})]}),S.jsxs("div",{className:E,children:[S.jsx("button",{className:x,...f,children:"-"}),S.jsx("input",{...p,id:T,className:B,ref:c}),S.jsx("button",{className:x,...I,children:"+"})]}),r&&e.errorMessage&&S.jsx("div",{className:b,children:e.errorMessage}),e.helperText&&S.jsx("div",{className:N(q.quantityToggleHelperText,"cdg-quantity-toggle-helper-text"),children:e.helperText})]})})});z.__docgenInfo={description:"",methods:[],displayName:"QuantityToggle"};z.displayName="QuantityToggle";export{z as Q};
