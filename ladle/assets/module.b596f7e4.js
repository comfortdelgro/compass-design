import{r as U}from"./index.2729102d.js";import{$ as E,j as N,c as P,b as M,i as H,k as W}from"./module.fec0fdc0.js";import{g as T,h as k,i as z}from"./module.9a300ccb.js";import{a as L}from"./module.bad04894.js";import{c as C,d as I}from"./module.16f8373d.js";import{$ as D}from"./module.cc5aa67b.js";const K=new WeakMap;function Y(e,t,s){let{type:o}=e,{isOpen:a}=t;U.exports.useEffect(()=>{s&&s.current&&K.set(s.current,t.close)});let d;o==="menu"?d=!0:o==="listbox"&&(d="listbox");let n=E();return{triggerProps:{"aria-haspopup":d,"aria-expanded":a,"aria-controls":a?n:null,onPress:t.toggle},overlayProps:{id:n}}}let $=new WeakMap,c=[];function Z(e,t=document.body){let s=new Set(e),o=new Set,a=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode(i){return(i instanceof HTMLElement||i instanceof SVGElement)&&i.dataset.liveAnnouncer==="true"&&s.add(i),s.has(i)||o.has(i.parentElement)&&i.parentElement.getAttribute("role")!=="row"?NodeFilter.FILTER_REJECT:e.some(l=>i.contains(l))?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}}),d=i=>{var l;let r=(l=$.get(i))!==null&&l!==void 0?l:0;i.getAttribute("aria-hidden")==="true"&&r===0||(r===0&&i.setAttribute("aria-hidden","true"),o.add(i),$.set(i,r+1))};c.length&&c[c.length-1].disconnect();let n=a.nextNode();for(;n!=null;)d(n),n=a.nextNode();let u=new MutationObserver(i=>{for(let l of i)if(!(l.type!=="childList"||l.addedNodes.length===0)&&![...s,...o].some(r=>r.contains(l.target)))for(let r of l.addedNodes)(r instanceof HTMLElement||r instanceof SVGElement)&&r.dataset.liveAnnouncer==="true"?s.add(r):r instanceof Element&&d(r)});u.observe(t,{childList:!0,subtree:!0});let f={observe(){u.observe(t,{childList:!0,subtree:!0})},disconnect(){u.disconnect()}};return c.push(f),()=>{u.disconnect();for(let i of o){let l=$.get(i);l===1?(i.removeAttribute("aria-hidden"),$.delete(i)):$.set(i,l-1)}f===c[c.length-1]?(c.pop(),c.length&&c[c.length-1].observe()):c.splice(c.indexOf(f),1)}}const g=new WeakMap;function R(e){return typeof e=="string"?e.replace(/\s*/g,""):""+e}function B(e,t){let s=g.get(e);if(!s)throw new Error("Unknown list");return`${s.id}-option-${R(t)}`}function ee(e,t,s){let o=N(e,{labelable:!0}),{listProps:a}=C({...e,ref:s,selectionManager:t.selectionManager,collection:t.collection,disabledKeys:t.disabledKeys}),{focusWithinProps:d}=T({onFocusWithin:e.onFocus,onBlurWithin:e.onBlur,onFocusWithinChange:e.onFocusChange}),n=E(e.id);g.set(t,{id:n,shouldUseVirtualFocus:e.shouldUseVirtualFocus,shouldSelectOnPressUp:e.shouldSelectOnPressUp,shouldFocusOnHover:e.shouldFocusOnHover,isVirtualized:e.isVirtualized,onAction:e.onAction});let{labelProps:u,fieldProps:f}=L({...e,id:n,labelElementType:"span"});return{labelProps:u,listBoxProps:P(o,d,t.selectionManager.selectionMode==="multiple"?{"aria-multiselectable":"true"}:{},{role:"listbox",...P(f,a)})}}function te(e,t,s){let{key:o}=e,a=g.get(t);var d;let n=(d=e.isDisabled)!==null&&d!==void 0?d:t.disabledKeys.has(o);var u;let f=(u=e.isSelected)!==null&&u!==void 0?u:t.selectionManager.isSelected(o),i=t.selectionManager.focusedKey===o;var l;let r=(l=e.shouldSelectOnPressUp)!==null&&l!==void 0?l:a.shouldSelectOnPressUp;var p;let m=(p=e.shouldFocusOnHover)!==null&&p!==void 0?p:a.shouldFocusOnHover;var h;let O=(h=e.shouldUseVirtualFocus)!==null&&h!==void 0?h:a.shouldUseVirtualFocus;var v;let x=(v=e.isVirtualized)!==null&&v!==void 0?v:a.isVirtualized,F=M(),S=M(),b={role:"option","aria-disabled":n,"aria-selected":t.selectionManager.selectionMode!=="none"?f:void 0};H()&&W()||(b["aria-label"]=e["aria-label"],b["aria-labelledby"]=F,b["aria-describedby"]=S),x&&(b["aria-posinset"]=t.collection.getItem(o).index+1,b["aria-setsize"]=D(t.collection));let{itemProps:_,isPressed:y,hasAction:w,allowsSelection:V}=I({selectionManager:t.selectionManager,key:o,ref:s,shouldSelectOnPressUp:r,allowsDifferentPressOrigin:r&&m,isVirtualized:x,shouldUseVirtualFocus:O,isDisabled:n,onAction:a.onAction?()=>a.onAction(o):void 0}),{hoverProps:A}=k({isDisabled:n||!m,onHoverStart(){z()||(t.selectionManager.setFocused(!0),t.selectionManager.setFocusedKey(o))}});return{optionProps:{...b,...P(_,A),id:B(t,o)},labelProps:{id:F},descriptionProps:{id:S},isFocused:i,isSelected:f,isDisabled:n,isPressed:y,allowsSelection:V,hasAction:w}}export{Y as $,g as a,Z as b,B as c,te as d,ee as e};
