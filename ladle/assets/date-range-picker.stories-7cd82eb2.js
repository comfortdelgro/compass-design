import{r as w,s as p,R as W,j as r,a as $,F as ne}from"./index-831beb71.js";import"./index-2d95e1ba.js";import{C as ee}from"./index-0e912b0c.js";import{$ as le,a as _,b as H,c as z,d as re}from"./import-6617c2cc.js";import{u as se,a as ie,b as de,c as oe,d as ce,D as A,P as ue,e as be}from"./useOverlayTriggerState-87d55759.js";import{u as fe,a as J,c as he,f as me,r as ye,b as De,d as ge,i as Q,g as M,e as X,D as Pe}from"./useCalendarState-aaf0c14a.js";import{R as Ce}from"./range-calendar-e2b3b207.js";import{u as Se}from"./use-dom-ref-3eb3c003.js";import{C as ve}from"./components-318c8bdb.js";import{B as Ve}from"./button-aafe28bd.js";import"./clsx.m-30223e4c.js";import"./utils-1787013b.js";import"./isArray-3dc8b06b.js";import"./useEvent-ce672b31.js";import"./import-8106036e.js";import"./index-ca27cb1d.js";function Fe(e,l,d){var t,s;const{labelProps:o,fieldProps:c,descriptionProps:g,errorMessageProps:a}=se({...e,labelElementType:"span"}),u=c["aria-labelledby"]||c.id,{locale:C}=le(),h=l.formatValue(C,{month:"long"}),y=h?`selectedRangeDescription ${h.start} ${h.end}`:"",b=fe(y),i={"aria-label":"startDate","aria-labelledby":u},m={"aria-label":"endDate","aria-labelledby":u},n=J(),P=J(),V=ie(l,d),S=[b["aria-describedby"],c["aria-describedby"]].filter(Boolean).join(" ")||void 0,F=w.useMemo(()=>he(d,{accept:f=>f.id!==n}),[d,n]),R={[me]:F,[ye]:"presentation","aria-describedby":S,minValue:e.minValue,maxValue:e.maxValue,placeholderValue:e.placeholderValue,hideTimeZone:e.hideTimeZone,hourCycle:e.hourCycle,granularity:e.granularity,isDisabled:e.isDisabled,isReadOnly:e.isReadOnly,isRequired:e.isRequired,validationState:l.validationState},x=De(e),{focusWithinProps:T}=de({...e,isDisabled:l.isOpen,onBlurWithin:e.onBlur,onFocusWithin:e.onFocus,onFocusWithinChange:e.onFocusChange});return{groupProps:{...x,...V,...c,...b,...T,role:"group","aria-disabled":e.isDisabled||null,"aria-describedby":S,onKeyDown(f){l.isOpen||e.onKeyDown&&e.onKeyDown(f)},onKeyUp(f){l.isOpen||e.onKeyUp&&e.onKeyUp(f)}},labelProps:{...o,onClick:()=>{F.focusFirst()}},buttonProps:{...b,id:n,"aria-haspopup":"dialog","aria-label":"calendar","aria-labelledby":`${u} ${n}`,"aria-describedby":S,"aria-expanded":l.isOpen||void 0,onPress:()=>l.setOpen(!0)},dialogProps:{id:P,"aria-labelledby":`${u} ${n}`},startFieldProps:{...i,...R,value:(t=l.value)==null?void 0:t.start,onChange:f=>l.setDateTime("start",f),autoFocus:e.autoFocus},endFieldProps:{...m,...R,value:(s=l.value)==null?void 0:s.end,onChange:f=>l.setDateTime("end",f)},descriptionProps:g,errorMessageProps:a,calendarProps:{autoFocus:!0,value:l.dateRange,onChange:l.setDateRange,minValue:e.minValue,maxValue:e.maxValue,isDisabled:e.isDisabled,isReadOnly:e.isReadOnly,isDateUnavailable:e.isDateUnavailable,allowsNonContiguousRanges:e.allowsNonContiguousRanges,defaultFocusedValue:l.dateRange?void 0:e.placeholderValue,validationState:l.validationState,errorMessage:e.errorMessage}}}function Oe(e){var x,T;const l=oe(e),[d,o]=ge(e.value,e.defaultValue||null,e.onChange);let[c,g]=w.useState(()=>d||{start:null,end:null});d==null&&c.start&&c.end&&(c={start:null,end:null},g(c));const a=d||c,u=t=>{g(t),t.start||t.end?o(t):o(null)},C=a.start||a.end||e.placeholderValue,[h]=ce(C,e.granularity),y=h==="hour"||h==="minute"||h==="second",b=e.shouldCloseOnSelect??!0;let[i,m]=w.useState(null),[n,P]=w.useState(null);a&&a.start&&a.end&&(i=a,"hour"in a.start&&(n=a));const V=(t,s)=>{t.end&&t.start&&s.end&&s.start&&(u({start:"timeZone"in s.start?s.start.set(H(t.start)):z(t.start,s.start),end:"timeZone"in s.end?s.end.set(H(t.end)):z(t.end,s.end)}),m(null),P(null))},S=t=>{let s=typeof b=="function"?b():b;y?s||t.start&&t.end&&(n!=null&&n.start)&&n.end?V(t,{start:(n==null?void 0:n.start)||M(e.placeholderValue),end:(n==null?void 0:n.end)||M(e.placeholderValue)}):m(t):t.start||t.end?u(t):!t.start||!t.end?(o({start:null,end:null}),m(null)):m(t),s&&t.start&&t.end&&l.setOpen(!1)},F=t=>{i!=null&&i.start&&i.end&&t.start&&t.end?V(i,t):P(t)},R=e.validationState||(a!=null&&(Q(a.start,e.minValue,e.maxValue)||Q(a.end,e.minValue,e.maxValue)||a.end!=null&&a.start!=null&&a.end.compare(a.start)<0||a.start&&((x=e.isDateUnavailable)!=null&&x.call(e,a.start))||a.end&&((T=e.isDateUnavailable)!=null&&T.call(e,a.end)))?"invalid":null);return{value:a,setValue:u,dateRange:i,timeRange:n,granularity:h,hasTime:y,setDate(t,s){S({...i,[t]:s})},setTime(t,s){F({...n,[t]:s})},setDateTime(t,s){u({...a,[t]:s})},setDateRange:S,setTimeRange:F,...l,setOpen(t){!t&&!(a.start&&a.end)&&(i!=null&&i.start)&&i.end&&y&&V(i,{start:(n==null?void 0:n.start)||M(e.placeholderValue),end:(n==null?void 0:n.end)||M(e.placeholderValue)}),l.setOpen(t)},validationState:R,formatValue(t,s){if(!a||!a.start||!a.end)return null;const f="timeZone"in a.start?a.start.timeZone:void 0,I=e.granularity||(a.start&&"minute"in a.start?"minute":"day"),L="timeZone"in a.end?a.end.timeZone:void 0,K=e.granularity||(a.end&&"minute"in a.end?"minute":"day"),te=X(s,{granularity:I,timeZone:f??"UTC",hideTimeZone:!!e.hideTimeZone,hourCycle:e.hourCycle??24,showEra:a.start.calendar.identifier==="gregory"&&a.start.era==="BC"||a.end.calendar.identifier==="gregory"&&a.end.era==="BC"}),N=a.start.toDate(f||"UTC"),G=a.end.toDate(L||"UTC"),Z=new _(t,te);let B;if(f===L&&I===K&&a.start.compare(a.end)!==0){try{const v=Z.formatRangeToParts(N,G);let E=-1;for(let D=0;D<v.length;D++){const U=v[D];if(U.source==="shared"&&U.type==="literal")E=D;else if(U.source==="endRange")break}let j="",q="";for(let D=0;D<v.length;D++)D<E?j+=v[D].value:D>E&&(q+=v[D].value);return{start:j,end:q}}catch{}B=Z}else{const v=X(s,{granularity:K,timeZone:L??"UTC",hideTimeZone:!!e.hideTimeZone,hourCycle:e.hourCycle??24});B=new _(t,v)}return{start:Z.format(N),end:B.format(G)}}}}const Re=p("div",{width:"fit-content"}),xe=p("div",{"& .date-range-fields":{display:"flex",gap:"$6"}}),Te=W.forwardRef((e,l)=>{const{startDateLabel:d,endDateLabel:o,shouldCloseOnSelect:c=!1,css:g={},errorMessage:a,helperText:u,maxValue:C,hasShortcuts:h,ctaButtonRender:y,onSearchButtonClick:b,customShortcuts:i,...m}=e,n=Oe({...m,isReadOnly:e.isReadOnly?!0:!!e.isMobile,shouldCloseOnSelect:e.granularity?!0:c??!1}),P=Se(l),{labelProps:V,groupProps:S,startFieldProps:F,endFieldProps:R,buttonProps:x,dialogProps:T,calendarProps:t}=Fe({...m,isReadOnly:e.isReadOnly?!0:!!e.isMobile,"aria-label":"date range picker","aria-describedby":""},n,P),s={necessityIndicator:e.necessityIndicator,...F},f={necessityIndicator:e.necessityIndicator,...R},I=()=>e.isReadOnly?!0:!(!e.isReadOnly&&!e.isMobile||e.isMobile);return t.isReadOnly=I(),r(Re,{ref:P,css:g,children:$(Pe,{children:[r($e,{state:n,label:e.label,labelProps:V,groupProps:S,startFieldProps:s,endFieldProps:f,buttonProps:x,startDateLabel:d,endDateLabel:o,isInvalid:e.isInvalid,isReadOnly:e.isReadOnly,isMobile:e.isMobile,errorMessage:a,helperText:u}),r(Ie,{maxValue:C,state:n,calendarRef:P,dialogProps:T,calendarProps:t,hasShortcuts:h,ctaButtonRender:y,onSearchButtonClick:b,customShortcuts:i,css:e.calendarCSS})]})})}),$e=W.forwardRef((e,l)=>{const{label:d,labelProps:o,groupProps:c,startFieldProps:g,endFieldProps:a,buttonProps:u,startDateLabel:C,endDateLabel:h,isInvalid:y,isMobile:b,isReadOnly:i=!1,errorMessage:m,helperText:n}=e;return $(xe,{children:[r("span",{...o,className:"date-range-label",children:d}),r("div",{...c,ref:l,className:"date-range-inputs-body",children:$("div",{className:"date-range-fields",children:[r(A,{...g,label:C,buttonProps:u,isInvalid:y,isMobile:b,isReadOnly:i,errorMessage:m,helperText:n}),r(A,{...a,label:h,buttonProps:u,isInvalid:y,isMobile:b,isReadOnly:i})]})})]})}),Ie=e=>{const{state:l,calendarRef:d,dialogProps:o,calendarProps:c,css:g={},hasShortcuts:a=!1,maxValue:u=re("2999-03-10"),ctaButtonRender:C,onSearchButtonClick:h,customShortcuts:y}=e,{value:b,onChange:i,...m}=c,n=P=>{i&&i(P)};return r(ne,{children:l.isOpen&&r(ue,{state:l,triggerRef:d,placement:"bottom start",offset:8,children:r(be,{...o,"aria-describedby":o["aria-describedby"]??"","aria-label":o["aria-label"]??"","aria-labelledby":o["aria-labelledby"]??"",children:r(Ce,{css:g,state:l,hasFooter:!0,"aria-label":"","aria-labelledby":"",...b?{value:b}:{},onChange:n,...m,maxValue:u,hasShortcuts:a,ctaButtonRender:C,onSearchButtonClick:h,customShortcuts:y})})})})},O=Te,{I18nProvider:ae,useDateFormatter:Me}=ee.I18N,{getLocalTimeZone:k,parseDate:Y}=ee.InternationalizedDate,Ae=()=>r(ae,{locale:"en-SG",children:$(ve,{children:[r("h3",{children:"Basic"}),r(O,{startDateLabel:"Start date",endDateLabel:"End date"}),r("br",{}),r("h3",{children:"Disabled"}),r(O,{isDisabled:!0,startDateLabel:"Start date",endDateLabel:"End date"}),r("h3",{children:"Read only"}),r(O,{isReadOnly:!0,startDateLabel:"Start date",endDateLabel:"End date"}),r("h3",{children:"Invalid"}),r(O,{isInvalid:!0,startDateLabel:"Start date",endDateLabel:"End date"}),r("h3",{children:"Helper texts"}),r(O,{isInvalid:!0,isRequired:!0,helperText:"Weekend is excluded",errorMessage:"Must not include weekend",startDateLabel:"Start date",endDateLabel:"End date"}),r("h3",{children:"Extended Range Calendar"}),r(O,{startDateLabel:"Start date",endDateLabel:"End date",hasShortcuts:!0,customShortcuts:e=>{const l=[{label:"Custom Shortcut",getValue:()=>({start:null,end:null})}];return[...e,...l]},ctaButtonRender:r(Ve,{onPress:()=>{alert("Custom callback")},children:"Custom Button"})})]})}),Je=()=>{const[e,l]=W.useState({start:Y("2020-02-03"),end:Y("2020-02-08")}),d=Me({dateStyle:"long"});return $(ae,{locale:"en-SG",children:[r("h3",{children:"Controlled"}),e.start&&e.end?d.formatRange(e.start.toDate(k()),e.end.toDate(k())):`${e.start&&d.format(e.start.toDate(k()))} - ${e.end&&d.format(e.end.toDate(k()))}`,r(O,{value:e,shouldCloseOnSelect:!0,onChange:o=>l(o)})]})},Qe={decorators:[e=>$("div",{children:[r("style",{dangerouslySetInnerHTML:{__html:".ladle-main { background: #eee; }"}}),r(e,{})]})]};typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{Je as Controlled,Ae as Variants,Qe as default};
