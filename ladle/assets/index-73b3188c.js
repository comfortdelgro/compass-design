"use client";import{j as S}from"./jsx-runtime-ea7736fc.js";import{r as d,R as B}from"./index-6c164b11.js";import{C as G}from"./objectToCSS-aff350d4.js";import{u as J}from"./use-dom-ref-7c72e1a5.js";import{u as Z}from"./useId-133e3351.js";import{u as ee,m as Y,a as te}from"./index-0d3b18cd.js";import{N as U,a as ne}from"./NumberParser-bd499a26.js";const oe="_quantityToggleWrapper_1gg2q_7",ae="_label_1gg2q_13",se="_asterix_1gg2q_22",re="_quantityToggle_1gg2q_7",le="_quantityToggleInput_1gg2q_32",ie="_quantityToggleButton_1gg2q_37",ue="_quantityToggleHelperText_1gg2q_84",ce="_quantityToggleWrapperIsDisabled_1gg2q_95",de="_quantityToggleInputIsDisabled_1gg2q_99",ge="_quantityToggleButtonIsDisabled_1gg2q_104",fe="_quantityToggleInputIsErrored_1gg2q_110",me="_quantityToggleButtonIsErrored_1gg2q_115",pe="_quantityToggleIsErrored_1gg2q_119",ye="_quantityToggleHelperTextIsErrored_1gg2q_129",q={quantityToggleWrapper:oe,label:ae,asterix:se,quantityToggle:re,quantityToggleInput:le,quantityToggleButton:ie,quantityToggleHelperText:ue,quantityToggleWrapperIsDisabled:ce,quantityToggleInputIsDisabled:de,quantityToggleButtonIsDisabled:ge,quantityToggleInputIsErrored:fe,quantityToggleButtonIsErrored:me,quantityToggleIsErrored:pe,quantityToggleHelperTextIsErrored:ye};function be(e,a){const{type:n="text",validationState:o,isDisabled:s=!1,isRequired:i=!1,isReadOnly:l=!1,onChange:t=()=>{}}=e,{focusableProps:r}=ee(e,a);return{inputProps:Y(e,{type:n,pattern:e.pattern,disabled:s,readOnly:l,"aria-required":i||void 0,"aria-invalid":o==="invalid"||void 0,"aria-errormessage":e["aria-errormessage"],"aria-activedescendant":e["aria-activedescendant"],"aria-autocomplete":e["aria-autocomplete"],"aria-haspopup":e["aria-haspopup"],value:e.value,defaultValue:e.value?void 0:e.defaultValue,onChange:u=>t(u.target.value),autoComplete:e.autoComplete,maxLength:e.maxLength,minLength:e.minLength,name:e.name,placeholder:e.placeholder,inputMode:e.inputMode,onCopy:e.onCopy,onCut:e.onCut,onPaste:e.onPaste,onCompositionEnd:e.onCompositionEnd,onCompositionStart:e.onCompositionStart,onCompositionUpdate:e.onCompositionUpdate,onSelect:e.onSelect,onBeforeInput:e.onBeforeInput,onInput:e.onInput,...r})}}function A(){return typeof window<"u"&&window.InputEvent&&typeof InputEvent.prototype.getTargetRanges=="function"}function Te(e,a,n){const o=d.useRef(a);o.current=a,d.useEffect(()=>{if(!A())return;const t=n.current,r=u=>{const T=o.current;let c;switch(u.inputType){case"historyUndo":case"historyRedo":return;case"deleteContent":case"deleteByCut":case"deleteByDrag":c=t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd);break;case"deleteContentForward":c=t.selectionEnd===t.selectionStart?t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd+1):t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd);break;case"deleteContentBackward":c=t.selectionEnd===t.selectionStart?t.value.slice(0,t.selectionStart-1)+t.value.slice(t.selectionStart):t.value.slice(0,t.selectionStart)+t.value.slice(t.selectionEnd);break;case"deleteSoftLineBackward":case"deleteHardLineBackward":c=t.value.slice(t.selectionStart);break;default:u.data!=null&&(c=t.value.slice(0,t.selectionStart)+u.data+t.value.slice(t.selectionEnd));break}(c==null||!T.validate(c))&&u.preventDefault()};return t.addEventListener("beforeinput",r,!1),()=>{t.removeEventListener("beforeinput",r,!1)}},[n,o]);const s=A()?null:t=>{const r=t.target.value.slice(0,t.target.selectionStart)+t.data+t.target.value.slice(t.target.selectionEnd);a.validate(r)||t.preventDefault()},{inputProps:i}=be(e,n),l=d.useRef(null);return{...Y(i,{onBeforeInput:s,onCompositionStart(){const{value:t,selectionStart:r,selectionEnd:u}=n.current;l.current={value:t,selectionStart:r,selectionEnd:u}},onCompositionEnd(){if(!a.validate(n.current.value)){const{value:t,selectionStart:r,selectionEnd:u}=l.current;n.current.value=t,n.current.setSelectionRange(r,u),a.setInputValue(t)}}})}}function qe(e){const a=d.useRef(),{isReadOnly:n,onIncrement:o,onDecrement:s,onIncrementPage:i,onDecrementPage:l,onDecrementToMin:t,onIncrementToMax:r}=e,u=d.useRef(e);u.current=e;const T=()=>clearTimeout(a.current);d.useEffect(()=>()=>T(),[]);const c=f=>{if(!(f.ctrlKey||f.metaKey||f.shiftKey||f.altKey||n))switch(f.key){case"PageUp":i&&(f.preventDefault(),i());break;case"ArrowUp":case"Up":o&&(f.preventDefault(),o());break;case"PageDown":l&&(f.preventDefault(),l());break;case"ArrowDown":case"Down":s&&(f.preventDefault(),s());break;case"Home":t&&(f.preventDefault(),t());break;case"End":r&&(f.preventDefault(),r());break}},m=d.useRef(!1);return{onKeyDown:c,onFocus:()=>{m.current=!0},onBlur:()=>{m.current=!1}}}function Ie(e={}){return d.useMemo(()=>new U("en-US",e),[e])}function he(e,a,n,o){d.useEffect(()=>{const s=e.current;return s&&n!==null&&s.addEventListener(a,n,o),()=>{s&&n!==null&&s.removeEventListener(a,n,o)}},[e,a,o,n])}function ve(e,a){const{onScroll:n,isDisabled:o}=e,s=d.useCallback(i=>{const l=i;l.ctrlKey||(l.preventDefault(),l.stopPropagation(),n&&n({deltaX:l.deltaX,deltaY:l.deltaY}))},[n]);he(a,"wheel",o?null:s,{passive:!1})}function xe(e,a,n){const{label:o,description:s,errorMessage:i,formatOptions:l,autoFocus:t=!1,isRequired:r=!1,isReadOnly:u=!1,isDisabled:T=!1,maxValue:c=1/0,minValue:m=-1/0,disableScroll:p=!0,validationState:I="valid",onBlur:f=()=>{},onKeyUp:N=()=>{},onFocus:E=()=>{},onKeyDown:w=()=>{},onFocusChange:x=()=>{},...b}=e,{inputValue:P,numberValue:_,commit:F,increment:y,decrement:D,incrementToMax:j,decrementToMin:R}=a,{focusProps:O}=te({onBlur:()=>F()}),k=Ie({...l,currencySign:void 0}),L=d.useMemo(()=>isNaN(_)?"":k.format(_),[k,_]),H=qe({maxValue:c,minValue:m,textValue:L,isRequired:r,isReadOnly:u,isDisabled:T,value:_,onIncrement:y,onDecrement:D,onIncrementToMax:j,onDecrementToMin:R}),W=d.useCallback(v=>{Math.abs(v.deltaY)<=Math.abs(v.deltaX)||(v.deltaY>0?y():v.deltaY<0&&D())},[D,y]);ve({onScroll:W,isDisabled:T||u||p},n);const g=Te({...b,label:o,autoFocus:t,isReadOnly:u,isRequired:r,isDisabled:T,description:s,errorMessage:i,type:"text",validationState:I,defaultValue:"",value:P,autoComplete:"off",inputMode:"numeric",onBlur:f,onFocus:E,onKeyUp:N,onChange:v=>{a.setInputValue(v)},onKeyDown:w,onFocusChange:x},a,n),h=Y(H,O,g,{autoCorrect:"off"}),M=()=>{var v;document.activeElement!==n.current&&((v=n.current)==null||v.focus())},C={"aria-label":"increase",slot:"increment",type:"button",tabIndex:-1,disabled:!a.canIncrement,onClick:()=>{M(),y()},onMouseDown:v=>v.preventDefault()},z={"aria-label":"decrease",slot:"decrement",type:"button",tabIndex:-1,disabled:!a.canDecrement,onClick:()=>{M(),D()},onMouseDown:v=>v.preventDefault()};return delete h.isErrored,delete h.isReadOnly,delete h.isRequired,delete h.isDisabled,delete h.helperText,delete h.defaultValue,delete h.errorMessage,delete h.validationState,delete h.onUpdate,delete h.onFocusChange,{inputProps:h,incrementButtonProps:C,decrementButtonProps:z}}function De(e,a=-1/0,n=1/0){return Math.min(Math.max(e,a),n)}function V(e,a,n,o){const s=(e-(a||0))%o;let i=Math.abs(s)*2>=o?e+Math.sign(s)*(o-Math.abs(s)):e-s;a?i<a?i=a:n&&i>n&&(i=a+Math.floor((n-a)/o)*o):n&&i>n&&(i=Math.floor(n/o)*o);const l=o.toString(),t=l.indexOf("."),r=t>=0?l.length-t:0;if(r>0){const u=Math.pow(10,r);i=Math.round(i*u)/u}return i}function Se(e,a,n){const[o,s]=d.useState(e??a),i=d.useRef(e!==void 0),l=e!==void 0,t=d.useRef(o);i.current=l;const r=d.useCallback((u,...T)=>{const c=(m,...p)=>{n&&(Object.is(t.current,m)||n(m,...p)),l||(t.current=m)};typeof u=="function"?s((p,...I)=>{const f=u(l?t.current:p,...I);return c(f,...T),l?p:f}):(l||s(u),c(u,...T))},[l,n]);return l?t.current=e:e=o,[e,r]}function Ee(e){const{step:a,value:n,minValue:o,maxValue:s,isReadOnly:i,isDisabled:l,defaultValue:t,formatOptions:r,locale:u="en-US",onChange:T}=e,[c,m]=Se(n,t&&isNaN(t)?NaN:t,T),[p,I]=d.useState(()=>isNaN(c)?"":new U(u,r).format(c)),f=d.useMemo(()=>new ne(u,r),[u,r]),N=d.useMemo(()=>f.getNumberingSystem(p),[f,p]),E=d.useMemo(()=>new U(u,{...r,numberingSystem:N}),[u,r,N]),w=d.useMemo(()=>E.resolvedOptions(),[E]),x=d.useCallback(g=>isNaN(g)||g===null?"":E.format(g),[E]);let b=a||1;w.style==="percent"&&!a&&(b=.01);const P=d.useRef(c),_=d.useRef(u),F=d.useRef(r);(!Object.is(c,P.current)||u!==_.current||r!==F.current)&&(I(x(c)),P.current=c,_.current=u,F.current=r);const y=d.useMemo(()=>f.parse(p),[f,p]),D=d.useRef(0);D.current=y;const j=()=>{if(!p.length){m(NaN),I(n===void 0?"":x(c));return}if(isNaN(D.current)){I(x(c));return}let g;a?g=V(D.current,o,s,a):g=De(D.current,o,s),g=f.parse(x(g)),m(g),I(x(n===void 0?g:c))},R=(g,h)=>{const M=D.current;if(isNaN(M))return V(h||0,o,s,b);{const C=V(M,o,s,b);return g==="+"&&C>M||g==="-"&&C<M?C:V(K(g,M,b),o,s,b)}},O=()=>{const g=R("+",o);g===c&&I(x(g)),m(g)},k=()=>{const g=R("-",s);g===c&&I(x(g)),m(g)},L=()=>{s!=null&&m(V(s,o,s,b))},H=()=>{o!=null&&m(o)},W=d.useMemo(()=>!l&&!i&&(isNaN(y)||!s||V(y,o,s,b)>y||K("+",y,b)<=s),[l,i,o,s,b,y]),Q=d.useMemo(()=>!l&&!i&&(isNaN(y)||!o||V(y,o,s,b)<y||K("-",y,b)>=o),[l,i,o,s,b,y]);return{inputValue:p,canIncrement:W,canDecrement:Q,minValue:o??-1/0,maxValue:s??1/0,numberValue:y,commit:j,validate:g=>f.isValidPartialNumber(g,o,s),increment:O,decrement:k,setInputValue:I,incrementToMax:L,decrementToMin:H}}function K(e,a,n){let o=e==="+"?a+n:a-n;if(a%1!==0||n%1!==0){const s=a.toString().split("."),i=n.toString().split("."),l=s[1]&&s[1].length||0,t=i[1]&&i[1].length||0,r=Math.pow(10,Math.max(l,t));a=Math.round(a*r),n=Math.round(n*r),o=e==="+"?a+n:a-n,o/=r}return o}const X=B.forwardRef((e,a)=>{const{id:n,label:o,css:s={},onUpdate:i,className:l,isRequired:t,isErrored:r=!1,...u}=e,T=Z(n),c=J(a),m=Ee(u),{inputProps:p,incrementButtonProps:I,decrementButtonProps:f}=xe(e,m,c);B.useEffect(()=>{i==null||i(m.inputValue,m.numberValue)},[m.numberValue,m.inputValue,i]);const N=B.useMemo(()=>[q.quantityToggleWrapper,!!p.disabled&&q.quantityToggleWrapperIsDisabled,"cdg-quantity-toggle-root",l].filter(Boolean).join(" "),[l,p.disabled]),E=B.useMemo(()=>[q.quantityToggle,r&&q.quantityToggleIsErrored,"cdg-quantity-toggle",l].filter(Boolean).join(" "),[l,r]),w=B.useMemo(()=>[q.quantityToggleInput,!!p.disabled&&q.quantityToggleInputIsDisabled,r&&q.quantityToggleInputIsErrored,"cdg-quantity-toggle-input"].filter(Boolean).join(" "),[p.disabled,r]),x=B.useMemo(()=>[q.quantityToggleButton,!!p.disabled&&q.quantityToggleButtonIsDisabled,r&&q.quantityToggleButtonIsErrored,"cdg-quantity-toggle-button"].filter(Boolean).join(" "),[p.disabled,r]),b=[q.quantityToggleHelperText,q.quantityToggleHelperTextIsErrored,"cdg-quantity-toggle-error-message"].filter(Boolean).join(" ");return S.jsx(G,{css:s,children:S.jsxs("div",{className:N,children:[e.label&&S.jsxs("label",{htmlFor:T,className:`${q.label} cdg-quantity-toggle-label`,children:[o,t&&S.jsx("span",{className:`${q.asterix} cdg-quantity-toggle-asterix`,children:"*"})]}),S.jsxs("div",{className:E,children:[S.jsx("button",{className:x,...f,children:"-"}),S.jsx("input",{id:T,className:w,ref:c,...p}),S.jsx("button",{className:x,...I,children:"+"})]}),r&&e.errorMessage&&S.jsx("div",{className:b,children:e.errorMessage}),e.helperText&&S.jsx("div",{className:`${q.quantityToggleHelperText} cdg-quantity-toggle-helper-text`,children:e.helperText})]})})});X.__docgenInfo={description:"",methods:[],displayName:"QuantityToggle"};X.displayName="QuantityToggle";export{X as Q};
