import{r as o,R as p}from"./index.659ddc59.js";import{_ as F,$ as E}from"./_define_property.cd994f27.js";class A{build(e,t){return this.context=t,w(()=>this.iterateCollection(e))}*iterateCollection(e){let{children:t,items:l}=e;if(typeof t=="function"){if(!l)throw new Error("props.children was a function but props.items is missing");for(let s of e.items)yield*this.getFullNode({value:s},{renderer:t})}else{let s=[];p.Children.forEach(t,r=>{s.push(r)});let n=0;for(let r of s){let a=this.getFullNode({element:r,index:n},{});for(let c of a)n++,yield c}}}getKey(e,t,l,s){if(e.key!=null)return e.key;if(t.type==="cell"&&t.key!=null)return`${s}${t.key}`;let n=t.value;if(n!=null){var r;let a=(r=n.key)!==null&&r!==void 0?r:n.id;if(a==null)throw new Error("No key found for item");return a}return s?`${s}.${t.index}`:`$.${t.index}`}getChildState(e,t){return{renderer:t.renderer||e.renderer}}*getFullNode(e,t,l,s){let n=e.element;if(!n&&e.value&&t&&t.renderer){let c=this.cache.get(e.value);if(c&&(!c.shouldInvalidate||!c.shouldInvalidate(this.context))){c.index=e.index,c.parentKey=s?s.key:null,yield c;return}n=t.renderer(e.value)}if(p.isValidElement(n)){let c=n.type;if(typeof c!="function"&&typeof c.getCollectionNode!="function"){let f=typeof n.type=="function"?n.type.name:n.type;throw new Error(`Unknown element <${f}> in collection.`)}let d=c.getCollectionNode(n.props,this.context),u=e.index,K=d.next();for(;!K.done&&K.value;){let f=K.value;e.index=u;let g=f.key;g||(g=f.element?null:this.getKey(n,e,t,l));let m=[...this.getFullNode({...f,key:g,index:u,wrapper:R(e.wrapper,f.wrapper)},this.getChildState(t,f),l?`${l}${n.key}`:n.key,s)];for(let y of m){if(y.value=f.value||e.value,y.value&&this.cache.set(y.value,y),e.type&&y.type!==e.type)throw new Error(`Unsupported type <${x(y.type)}> in <${x(s.type)}>. Only <${x(e.type)}> is supported.`);u++,yield y}K=d.next(m)}return}if(e.key==null)return;let r=this,a={type:e.type,props:e.props,key:e.key,parentKey:s?s.key:null,value:e.value,level:s?s.level+1:0,index:e.index,rendered:e.rendered,textValue:e.textValue,"aria-label":e["aria-label"],wrapper:e.wrapper,shouldInvalidate:e.shouldInvalidate,hasChildNodes:e.hasChildNodes,childNodes:w(function*(){if(!e.hasChildNodes)return;let c=0;for(let d of e.childNodes()){d.key!=null&&(d.key=`${a.key}${d.key}`),d.index=c;let u=r.getFullNode(d,r.getChildState(t,d),a.key,a);for(let K of u)c++,yield K}})};yield a}constructor(){F(this,"cache",new WeakMap)}}function w(i){let e=[],t=null;return{*[Symbol.iterator](){for(let l of e)yield l;t||(t=i());for(let l of t)e.push(l),yield l}}}function R(i,e){if(i&&e)return t=>i(e(t));if(i)return i;if(e)return e}function x(i){return i[0].toUpperCase()+i.slice(1)}function k(i,e,t,l=[]){let s=o.exports.useMemo(()=>new A,[]),n=o.exports.useRef(null);return o.exports.useMemo(()=>{let r=s.build(i,t);return n.current=e(r,n.current),n.current},[s,i.children,i.items,t,...l])}const M=new WeakMap;function z(i){let e=M.get(i);if(e!=null)return e;e=0;for(let t of i)t.type==="section"?e+=z(t.childNodes):e++;return M.set(i,e),e}class h extends Set{constructor(e,t,l){super(e),e instanceof h?(this.anchorKey=t||e.anchorKey,this.currentKey=l||e.currentKey):(this.anchorKey=t,this.currentKey=l)}}function _(i,e){if(i.size!==e.size)return!1;for(let t of i)if(!e.has(t))return!1;return!0}function V(i){let{selectionMode:e="none",disallowEmptySelection:t,allowDuplicateSelectionEvents:l,selectionBehavior:s="toggle",disabledBehavior:n="all"}=i,r=o.exports.useRef(!1),[,a]=o.exports.useState(!1),c=o.exports.useRef(null),d=o.exports.useRef(null),[,u]=o.exports.useState(null),K=o.exports.useMemo(()=>I(i.selectedKeys),[i.selectedKeys]),f=o.exports.useMemo(()=>I(i.defaultSelectedKeys,new h),[i.defaultSelectedKeys]),[g,b]=E(K,f,i.onSelectionChange),m=o.exports.useMemo(()=>i.disabledKeys?new Set(i.disabledKeys):new Set,[i.disabledKeys]),[y,v]=o.exports.useState(s);s==="replace"&&y==="toggle"&&typeof g=="object"&&g.size===0&&v("replace");let $=o.exports.useRef(s);return o.exports.useEffect(()=>{s!==$.current&&(v(s),$.current=s)},[s]),{selectionMode:e,disallowEmptySelection:t,selectionBehavior:y,setSelectionBehavior:v,get isFocused(){return r.current},setFocused(S){r.current=S,a(S)},get focusedKey(){return c.current},get childFocusStrategy(){return d.current},setFocusedKey(S,B="first"){c.current=S,d.current=B,u(S)},selectedKeys:g,setSelectedKeys(S){(l||!_(S,g))&&b(S)},disabledKeys:m,disabledBehavior:n}}function I(i,e){return i?i==="all"?"all":new h(i):e}class T{get selectionMode(){return this.state.selectionMode}get disallowEmptySelection(){return this.state.disallowEmptySelection}get selectionBehavior(){return this.state.selectionBehavior}setSelectionBehavior(e){this.state.setSelectionBehavior(e)}get isFocused(){return this.state.isFocused}setFocused(e){this.state.setFocused(e)}get focusedKey(){return this.state.focusedKey}get childFocusStrategy(){return this.state.childFocusStrategy}setFocusedKey(e,t){(e==null||this.collection.getItem(e))&&this.state.setFocusedKey(e,t)}get selectedKeys(){return this.state.selectedKeys==="all"?new Set(this.getSelectAllKeys()):this.state.selectedKeys}get rawSelection(){return this.state.selectedKeys}isSelected(e){return this.state.selectionMode==="none"?!1:(e=this.getKey(e),this.state.selectedKeys==="all"?this.canSelectItem(e):this.state.selectedKeys.has(e))}get isEmpty(){return this.state.selectedKeys!=="all"&&this.state.selectedKeys.size===0}get isSelectAll(){if(this.isEmpty)return!1;if(this.state.selectedKeys==="all")return!0;if(this._isSelectAll!=null)return this._isSelectAll;let e=this.getSelectAllKeys(),t=this.state.selectedKeys;return this._isSelectAll=e.every(l=>t.has(l)),this._isSelectAll}get firstSelectedKey(){let e=null;for(let t of this.state.selectedKeys){let l=this.collection.getItem(t);(!e||(l==null?void 0:l.index)<e.index)&&(e=l)}return e==null?void 0:e.key}get lastSelectedKey(){let e=null;for(let t of this.state.selectedKeys){let l=this.collection.getItem(t);(!e||(l==null?void 0:l.index)>e.index)&&(e=l)}return e==null?void 0:e.key}get disabledKeys(){return this.state.disabledKeys}get disabledBehavior(){return this.state.disabledBehavior}extendSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"){this.replaceSelection(e);return}e=this.getKey(e);let t;if(this.state.selectedKeys==="all")t=new h([e],e,e);else{let l=this.state.selectedKeys,s=l.anchorKey||e;t=new h(l,s,e);for(let n of this.getKeyRange(s,l.currentKey||e))t.delete(n);for(let n of this.getKeyRange(e,s))this.canSelectItem(n)&&t.add(n)}this.state.setSelectedKeys(t)}getKeyRange(e,t){let l=this.collection.getItem(e),s=this.collection.getItem(t);return l&&s?l.index<=s.index?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){let l=[],s=e;for(;s;){let n=this.collection.getItem(s);if((n&&n.type==="item"||n.type==="cell"&&this.allowsCellSelection)&&l.push(s),s===t)return l;s=this.collection.getKeyAfter(s)}return[]}getKey(e){let t=this.collection.getItem(e);if(!t||t.type==="cell"&&this.allowsCellSelection)return e;for(;t.type!=="item"&&t.parentKey!=null;)t=this.collection.getItem(t.parentKey);return!t||t.type!=="item"?null:t.key}toggleSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"&&!this.isSelected(e)){this.replaceSelection(e);return}if(e=this.getKey(e),e==null)return;let t=new h(this.state.selectedKeys==="all"?this.getSelectAllKeys():this.state.selectedKeys);t.has(e)?t.delete(e):this.canSelectItem(e)&&(t.add(e),t.anchorKey=e,t.currentKey=e),!(this.disallowEmptySelection&&t.size===0)&&this.state.setSelectedKeys(t)}replaceSelection(e){if(this.selectionMode==="none"||(e=this.getKey(e),e==null))return;let t=this.canSelectItem(e)?new h([e],e,e):new h;this.state.setSelectedKeys(t)}setSelectedKeys(e){if(this.selectionMode==="none")return;let t=new h;for(let l of e)if(l=this.getKey(l),l!=null&&(t.add(l),this.selectionMode==="single"))break;this.state.setSelectedKeys(t)}getSelectAllKeys(){let e=[],t=l=>{for(;l;){if(this.canSelectItem(l)){let s=this.collection.getItem(l);s.type==="item"&&e.push(l),s.hasChildNodes&&(this.allowsCellSelection||s.type!=="item")&&t([...s.childNodes][0].key)}l=this.collection.getKeyAfter(l)}};return t(this.collection.getFirstKey()),e}selectAll(){this.selectionMode==="multiple"&&this.state.setSelectedKeys("all")}clearSelection(){!this.disallowEmptySelection&&(this.state.selectedKeys==="all"||this.state.selectedKeys.size>0)&&this.state.setSelectedKeys(new h)}toggleSelectAll(){this.isSelectAll?this.clearSelection():this.selectAll()}select(e,t){this.selectionMode!=="none"&&(this.selectionMode==="single"?this.isSelected(e)&&!this.disallowEmptySelection?this.toggleSelection(e):this.replaceSelection(e):this.selectionBehavior==="toggle"||t&&(t.pointerType==="touch"||t.pointerType==="virtual")?this.toggleSelection(e):this.replaceSelection(e))}isSelectionEqual(e){if(e===this.state.selectedKeys)return!0;let t=this.selectedKeys;if(e.size!==t.size)return!1;for(let l of e)if(!t.has(l))return!1;for(let l of t)if(!e.has(l))return!1;return!0}canSelectItem(e){if(this.state.selectionMode==="none"||this.state.disabledKeys.has(e))return!1;let t=this.collection.getItem(e);return!(!t||t.type==="cell"&&!this.allowsCellSelection)}isDisabled(e){return this.state.disabledKeys.has(e)&&this.state.disabledBehavior==="all"}constructor(e,t,l){this.collection=e,this.state=t;var s;this.allowsCellSelection=(s=l==null?void 0:l.allowsCellSelection)!==null&&s!==void 0?s:!1,this._isSelectAll=null}}let W=Symbol.iterator;class C{*[W](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){let t=this.keyMap.get(e);return t?t.prevKey:null}getKeyAfter(e){let t=this.keyMap.get(e);return t?t.nextKey:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){return this.keyMap.get(e)}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}constructor(e){F(this,"keyMap",new Map),this.iterable=e;let t=n=>{if(this.keyMap.set(n.key,n),n.childNodes&&n.type==="section")for(let r of n.childNodes)t(r)};for(let n of e)t(n);let l,s=0;for(let[n,r]of this.keyMap)l?(l.nextKey=n,r.prevKey=l.key):(this.firstKey=n,r.prevKey=void 0),r.type==="item"&&(r.index=s++),l=r,l.nextKey=void 0;this.lastKey=l==null?void 0:l.key}}function D(i){let{filter:e}=i,t=V(i),l=o.exports.useMemo(()=>i.disabledKeys?new Set(i.disabledKeys):new Set,[i.disabledKeys]),s=a=>e?new C(e(a)):new C(a),n=o.exports.useMemo(()=>({suppressTextValueWarning:i.suppressTextValueWarning}),[i.suppressTextValueWarning]),r=k(i,s,n,[e]);return o.exports.useEffect(()=>{t.focusedKey!=null&&!r.getItem(t.focusedKey)&&t.setFocusedKey(null)},[r,t.focusedKey]),{collection:r,disabledKeys:l,selectionManager:new T(r,t)}}function q(i){var e;let[t,l]=E(i.selectedKey,(e=i.defaultSelectedKey)!==null&&e!==void 0?e:null,i.onSelectionChange),s=o.exports.useMemo(()=>t!=null?[t]:[],[t]),{collection:n,disabledKeys:r,selectionManager:a}=D({...i,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:s,onSelectionChange:d=>{let u=d.values().next().value;u===t&&i.onSelectionChange&&i.onSelectionChange(u),l(u)}}),c=t!=null?n.getItem(t):null;return{collection:n,disabledKeys:r,selectionManager:a,selectedKey:t,setSelectedKey:l,selectedItem:c}}export{z as $,q as a,C as b};
