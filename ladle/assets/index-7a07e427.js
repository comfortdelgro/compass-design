import{r as e,R as p,a as N,j as s,F as Ke}from"./index-0e1a662f.js";import{P as $e}from"./index-374924a6.js";import{u as H}from"./use-dom-ref-bdc44261.js";import{p as Be}from"./pick-child-7f74d5d1.js";import{S as Te,a as ve,b as Ae,c as He,d as Pe,e as je,f as We,g as ge,h as Ue,i as _e,j as qe,k as Ge,l as Ye,m as Ze,n as Ce,o as ze}from"./dropdown.styles-a55efda8.js";import{t as T,D as Ee,g as Je,a as De,b as Oe,c as Qe,d as Xe,e as et}from"./utils-2ed21dba.js";const re=e.createContext({open:!1,searchValue:"",selectedItem:null,disabledKeys:[],selectedKey:"",defaultSelectedKey:"",setSelectedItem:()=>{},onItemClick:()=>{}}),tt=p.forwardRef((d,b)=>{const{children:f,value:r="",flagName:S,type:a,rightIcon:w,leftIcon:g,rightColor:y,css:F={},...E}=d,{textValue:k,...R}=E,{selectedItem:u,disabledKeys:h=[],searchValue:M,focusKey:j,selectedKey:C,setSelectedItem:te,setDropdownItemKeys:x,onItemClick:q}=e.useContext(re),I=H(b),K=e.useMemo(()=>(u==null?void 0:u.value.toString())===r.toString(),[u,r]),A=e.useMemo(()=>(j==null?void 0:j.toString())===r.toString(),[j,r]),W=e.useMemo(()=>h.findIndex(L=>L.toString()===r.toString())!==-1,[h,r]),c=e.useMemo(()=>!M||T(f).toLocaleLowerCase().includes(M.toLocaleLowerCase()),[M,f]);return e.useEffect(()=>{W||x==null||x(L=>{const J=L.findIndex(l=>l.value.toString()===r.toString());return J===-1?L.push({value:r,visibility:!0}):L[J]={value:r,visibility:c},L})},[r,W,c]),e.useEffect(()=>{C&&C.toString()===r.toString()&&te({value:r.toString(),displayValue:k||f})},[C,r]),e.useEffect(()=>{(A||K&&A)&&setTimeout(()=>{I.current&&I.current.scrollIntoView({block:"nearest"})},0)},[A,K]),c?N(Te,{css:F,isFocused:A,isSelected:K&&!A,isDisabled:W,onClick:()=>{W||q({value:r.toString(),displayValue:k||f,flagName:S??""})},ref:I,...R,children:[g&&s(ve,{children:g}),s(Ae,{children:f}),a==="icon"&&w&&s(ve,{children:w}),a==="color"&&y&&s(He,{css:{$$bg:y}})]}):null}),st=tt;function ot(){return s(Pe,{children:N("div",{className:"spinner",children:[s("div",{className:"spinner-1"}),s("div",{className:"spinner-2"}),s("div",{className:"spinner-3"}),s("div",{})]})})}function rt(d){const[b,f]=e.useState(!1),r=e.useMemo(()=>new IntersectionObserver(([S])=>f(!!(S!=null&&S.isIntersecting))),[d.current]);return e.useEffect(()=>(d.current&&r.observe(d.current),()=>{r.disconnect()}),[d,r]),b}const nt=d=>{const{children:b,isLoading:f,css:r={},noDataMessage:S,onLoadMore:a}=d,w=H(null),g=H(null),y=rt(w),{searchValue:F}=e.useContext(re),{child:E,rest:k}=Be(b,Ee),R=e.useMemo(()=>{let u=0;return p.Children.map(k,h=>{T(h).toLocaleLowerCase().includes(F.toLocaleLowerCase())&&u++}),u},[k,F]);return e.useEffect(()=>{if(w.current&&g.current){const u=Je(w.current,g.current);y&&u>=0&&u<4&&(a==null||a())}},[y]),e.useMemo(()=>N(Ke,{children:[E&&E,N(je,{css:r,children:[f?s(ot,{}):R===0?s(We,{children:S||"No data"}):k,p.Children.toArray(k).length>0&&s(ge,{ref:w}),s(ge,{ref:g})]})]}),[r,f,R,b])},lt=nt,ct=p.forwardRef((d,b)=>s(P,{...d,ref:b,type:"combobox"})),at=ct,it=p.forwardRef((d,b)=>{const{children:f,title:r,isClickable:S,css:a={},onClick:w,...g}=d,y=H(b),[F,E]=e.useState(null);return e.useEffect(()=>{const R=p.Children.map(f,u=>{var M;const h=p.cloneElement(u);return(M=h==null?void 0:h.props)!=null&&M.value?h:p.cloneElement(h,{value:h.key||""})});E(R)},[f]),N(Ue,{css:a,ref:y,...g,children:[r&&s(_e,{isClickable:!!S,onClick:()=>{S&&(w==null||w())},children:r}),F]})}),ut=it,dt=p.forwardRef((d,b)=>s(P,{...d,ref:b,type:"select"})),ft=dt,pt=()=>s(ze,{width:"16",height:"16",viewBox:"0 0 16 16",className:"cdg-dropdown-button-icon",children:s("path",{d:"M8.33276 12.3334C8.02004 12.3334 7.70717 12.2125 7.46885 11.9707L1.35805 5.78022C0.880649 5.29658 0.880649 4.5131 1.35805 4.02947C1.83546 3.54584 2.60886 3.54584 3.08626 4.02947L8.33276 9.34651L13.5804 4.03044C14.0578 3.54681 14.8312 3.54681 15.3086 4.03044C15.786 4.51407 15.786 5.29755 15.3086 5.78118L9.19782 11.9717C8.95912 12.2135 8.64594 12.3334 8.33276 12.3334Z",fill:"currentColor"})}),mt=32,Z=()=>{},bt=p.forwardRef((d,b)=>{const{id:f=`cdg-element-${Math.random().toString(36).substring(2)}`,css:r={},children:S,type:a="select",icon:w=s(pt,{}),placeholder:g,isErrored:y=!1,isRequired:F=!1,isReadOnly:E=!1,isLoading:k=!1,helperText:R,selectedKey:u="",errorMessage:h,numberOfRows:M,disabledKeys:j=[],defaultSelectedKey:C="",defaultOpen:te=!1,isDisabled:x=!1,shouldDeselect:q=!1,allowsCustomValue:I=!1,disableClearable:K=!1,prefix:A=null,noDataMessage:W="",onSelectionChange:c=Z,onFocus:z=Z,onBlur:L=Z,onLoadMore:J=Z,onOpenChange:l=Z,...ke}=d,[v,U]=p.useState(te),[o,O]=p.useState(null),[ne,xe]=p.useState(null),[se,$]=p.useState(u||C),[le,oe]=e.useState(""),[_,Ie]=e.useState([]),[V,Le]=e.useState(null),Ve=H(b),ce=H(null),m=H(null),ae=e.useRef(!1),Q=e.useMemo(()=>!!C||!C&&!u,[C]),Re=e.useMemo(()=>{var t,i;switch(a){case"select":return((t=ce.current)==null?void 0:t.clientWidth)??"100%";case"combobox":return((i=m.current)==null?void 0:i.clientWidth)??"100%";default:return"100%"}},[a,v]);e.useEffect(()=>{ae.current?!v&&I&&$(""):ae.current=!0},[v,I]),e.useEffect(()=>{const t=p.Children.map(S,i=>{var G;const D=p.cloneElement(i);return(G=D==null?void 0:D.props)!=null&&G.value?D:p.cloneElement(D,{value:D.key||""})});Le(t)},[S]);const B=e.useCallback(t=>{Q&&(O(t),console.log("setValueForItemAndFocusKey: ",(t==null?void 0:t.value)??""),$((t==null?void 0:t.value)??""))},[Q]),X=e.useCallback(t=>{var D,G,de,fe,pe,me,be,we,he,Se,ye;const i=(se||(o==null?void 0:o.value.toString()))??"";switch(t.key){case"ArrowUp":case"ArrowLeft":if(t.preventDefault(),i){const n=Xe(i,V,_),Y=(n==null?void 0:n.props.value)??((D=n==null?void 0:n.key)==null?void 0:D.toString().replace(".$",""))??"";Y&&$(Y)}else $(((fe=(de=(G=et(V,_))==null?void 0:G.props)==null?void 0:de.value)==null?void 0:fe.toString())??"");break;case"ArrowDown":case"ArrowRight":if(t.preventDefault(),i){const n=Oe(i,V,_),Y=(n==null?void 0:n.props.value)??((pe=n==null?void 0:n.key)==null?void 0:pe.toString().replace(".$",""))??"";Y&&$(Y)}else $(((we=(be=(me=Qe(V,_))==null?void 0:me.props)==null?void 0:be.value)==null?void 0:we.toString())??"");break;case"Enter":if(t.preventDefault(),i){const n=De(i,V);if(n){if(U(!1),l==null||l(!1),!K&&q&&(o==null?void 0:o.value)===n.props.value){B(null),c==null||c("");return}B({value:((Se=(he=n==null?void 0:n.props)==null?void 0:he.value)==null?void 0:Se.toString())??"",displayValue:n.props.textValue||n.props.children,flagName:n.props.flagName??""}),m.current&&(m.current.value=T(n.props.children)),c==null||c((ye=n==null?void 0:n.props)==null?void 0:ye.value)}}break;case"Escape":case"Tab":U(!1),l==null||l(!1);break}},[K,q,se,V,o,_,l,B]);e.useEffect(()=>(v?document.addEventListener("keydown",X):document.removeEventListener("keydown",X),()=>{document.removeEventListener("keydown",X)}),[v,X]);const ee=e.useCallback(()=>{var t;U(i=>!i),l==null||l(!v),(t=m.current)==null||t.focus()},[l,v]),ie=e.useCallback(t=>{U(!0),l==null||l(!0),oe(t.target.value??""),a==="combobox"&&I&&(B(null),c==null||c(""))},[Q,a,o,ne,I,l,c,B]),ue=e.useCallback(()=>{["combobox"].includes(a)&&m.current&&setTimeout(()=>{document.activeElement!==m.current&&m.current&&(I||(o?m.current.value=T(o==null?void 0:o.displayValue):m.current.value=""),oe(""))})},[a,ne,o,I,Q]);e.useEffect(()=>{!v&&["combobox"].includes(a)&&m.current&&ue()},[v,a,ue]),e.useEffect(()=>{var D;if(!V||!u&&!C){O(null),$("");return}const t=u||C,i=De(t,V);i&&(O({value:t.toString(),displayValue:i,flagName:((D=i==null?void 0:i.props)==null?void 0:D.flagName)??""}),$(t.toString()),m.current&&(m.current.value=T(i)))},[V,u,C]);const Me=e.useMemo(()=>{switch(a){case"select":return s(Ge,{isEmpty:!o,className:"cdg-dropdown-input",isErrored:!!y,isDisabled:x,children:N("button",{id:f,type:"button",ref:ce,disabled:x,onClick:ee,onBlur:L,onFocus:z,className:"cdg-dropdown-button",children:[A,s("span",{children:o?T(o==null?void 0:o.displayValue):g}),w]})});case"combobox":return N(qe,{isEmpty:!o,className:"cdg-dropdown-input",isErrored:!!y,isDisabled:x,children:[s("input",{id:f,ref:m,readOnly:E,disabled:x,placeholder:g,onChange:ie,onBlur:L,onFocus:z,onClick:ee}),s("button",{type:"button",tabIndex:-1,disabled:x,onClick:ee,className:"cdg-dropdown-button",children:w})]});default:return null}},[v,a,f,g,o,y,x,E,L,z,ee,ie]),Ne=t=>{if(!E){if(U(!1),l==null||l(!1),!K&&!t.value){B(null),c==null||c("");return}if(!K&&q&&(o==null?void 0:o.value)===t.value){B(null),c==null||c("");return}(o==null?void 0:o.value)!==t.value&&(c==null||c(t.value)),B(t),xe(t),["combobox"].includes(a)&&(m.current&&(m.current.value=T(t.displayValue),m.current.blur()),oe(T(t.displayValue)))}},Fe=e.useCallback(()=>{U(!1),l==null||l(!1)},[l]);return N(Ye,{className:`${v?"cdg-dropdown-opening":""}`,css:r,ref:Ve,...ke,children:[d.label&&N("label",{htmlFor:f,children:[d.label,F&&s("span",{children:"*"})]}),s(re.Provider,{value:{open:v,focusKey:se??"",selectedKey:u,defaultSelectedKey:C,disabledKeys:j,searchValue:le,selectedItem:o,setSelectedItem:O,dropdownItemKeys:_,setDropdownItemKeys:Ie,onItemClick:Ne},children:s($e,{isOpen:v,anchor:Me,css:{width:"100%"},direction:"bottom",onClose:Fe,children:s(Ze,{style:{width:Re},children:s(lt,{searchValue:le,isLoading:k,css:{maxHeight:M?`${M*mt}px`:"16rem"},onLoadMore:J,noDataMessage:W,children:V})})})}),y&&h&&s(Ce,{error:!!y,children:h}),R&&s(Ce,{children:R})]})}),P=bt;P.Item=st;P.Select=ft;P.ComboBox=at;P.Section=ut;P.Header=Ee;export{P as D};
