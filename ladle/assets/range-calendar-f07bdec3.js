import{b as j,A as ee,B as ae,F as H,e as ne,i as re,d as te,$ as ie,m as se,k as oe,w as B,v as M}from"./import-a63e98a2.js";import{r as d,s as le,R as ce,a as F,j as C}from"./index-6668e921.js";import"./index-48e7f10a.js";import{b as ue,z as Z,l as de,v as fe,d as be,E as ge,A as ve,i as N,F as _,G as me,H as $e,o as De,C as he,B as q}from"./useCalendarState-b290a66b.js";import{u as Re,a as I}from"./useEvent-91490201.js";import{u as xe}from"./use-dom-ref-8557f905.js";import{B as J}from"./button-1ed1cc71.js";function Ce(a,e){var R,l,x,D;const g=ue(a);if(e.visibleRange==null)return{};const m=Z(e.visibleRange.start,e.timeZone??"UTC"),$=Z(e.visibleRange.start,e.timeZone??"UTC"),f=Re([!!a.errorMessage,a.validationState]);de.set(e,{ariaLabel:a["aria-label"]??"",ariaLabelledBy:a["aria-labelledby"],errorMessageId:f});const o=d.useRef(!1),s=a.isDisabled||((R=e.isNextVisibleRangeInvalid)==null?void 0:R.call(e));s&&o.current&&(o.current=!1,(l=e.setFocused)==null||l.call(e,!0));const r=d.useRef(!1),b=a.isDisabled||((x=e.isPreviousVisibleRangeInvalid)==null?void 0:x.call(e));b&&r.current&&(r.current=!1,(D=e.setFocused)==null||D.call(e,!0));const n=fe({id:a.id,"aria-label":[a["aria-label"],$].filter(Boolean).join(", "),"aria-labelledby":a["aria-labelledby"]});return{calendarProps:{...g,...n,role:"group","aria-describedby":a["aria-describedby"]||void 0},nextButtonProps:{onPress:()=>{var c;return(c=e.focusNextPage)==null?void 0:c.call(e)},"aria-label":"next",isDisabled:s,onFocus:()=>o.current=!0,onBlur:()=>o.current=!1},prevButtonProps:{onPress:()=>{var c;return(c=e.focusPreviousPage)==null?void 0:c.call(e)},"aria-label":"previous",isDisabled:b,onFocus:()=>r.current=!0,onBlur:()=>r.current=!1},title:m}}function pe(a,e,g){const m=Ce(a,e),$=d.useRef(!1),f=d.useRef(typeof window<"u"?window:null);I(f,"pointerdown",s=>{$.current=s.width===0&&s.height===0});const o=s=>{var n;if($.current){$.current=!1;return}if(e.setDragging(!1),!e.anchorDate)return;const r=s.target,b=document.getElementById(m.calendarProps.id);b&&b.contains(document.activeElement)&&(!b.contains(r)||!r.closest('button, [role="button"]'))&&((n=e.selectFocusedDate)==null||n.call(e))};return I(f,"pointerup",o),I(f,"pointercancel",o),m.calendarProps.onBlur=s=>{var r;(!s.relatedTarget||!g.current.contains(s.relatedTarget))&&e.anchorDate&&((r=e.selectFocusedDate)==null||r.call(e))},I(g,"touchmove",s=>{e.isDragging&&s.preventDefault()},{passive:!1,capture:!0}),m}function ye(a){var V,z,L,O;const{value:e,defaultValue:g,onChange:m,createCalendar:$,locale:f,visibleDuration:o={months:1},minValue:s,maxValue:r,...b}=a,[n,R]=be(e,g||null,m),[l,x]=d.useState(null);let D="center";if(n&&n.start&&n.end){const u=ge(j(n.start),o,f,s,r).add(o).subtract({days:1});n.end.compare(u)>0&&(D="start")}const c=d.useRef(null),[v,p]=d.useState(),y=d.useMemo(()=>ee(s,v==null?void 0:v.start),[s,v]),P=d.useMemo(()=>ae(r,v==null?void 0:v.end),[r,v]),t=ve({...b,value:n&&n.start,createCalendar:$,locale:f,visibleDuration:o,minValue:y,maxValue:P,selectionAlignment:D}),T=i=>{i&&a.isDateUnavailable&&!a.allowsNonContiguousRanges?(c.current={start:_(i,t,-1),end:_(i,t,1)},p(c.current)):(c.current=null,p(void 0))},k=d.useRef(t.visibleRange);(!H((V=t.visibleRange)==null?void 0:V.start,(z=k.current)==null?void 0:z.start)||!H((L=t.visibleRange)==null?void 0:L.end,(O=k.current)==null?void 0:O.end))&&(T(l),k.current=t.visibleRange);const A=i=>{i?(x(i),T(i)):(x(null),T(null))},S=l?U(l,t.focusedDate):n&&U(n.start,n.end),E=i=>{var u;if(!a.isReadOnly&&(i=me(i,y,P),i=$e(i,(u=t.visibleRange)==null?void 0:u.start,a.isDateUnavailable),!!i))if(!l)A(i);else{const h=U(l,i);R({start:K(h.start,n==null?void 0:n.start),end:K(h.end,n==null?void 0:n.end)}),A(null)}},[Q,W]=d.useState(!1),{isDateUnavailable:w}=a,X=d.useMemo(()=>!n||l?!1:w&&(w(n.start)||w(n.end))?!0:N(n.start,s,r)||N(n.end,s,r),[w,n,l,s,r]),Y=a.validationState||(X?"invalid":null);return{...t,value:n,setValue:R,anchorDate:l,setAnchorDate:A,highlightedRange:S,validationState:Y,selectFocusedDate(){E(t.focusedDate)},selectDate:E,highlightDate(i){var u;l&&((u=t.setFocusedDate)==null||u.call(t,i))},isSelected(i){var u,h;return S&&i.compare(S.start)>=0&&i.compare(S.end)<=0&&!((u=t.isCellDisabled)!=null&&u.call(t,i))&&!((h=t.isCellUnavailable)!=null&&h.call(t,i))},isInvalid(i){var u,h,G;return((u=t.isInvalid)==null?void 0:u.call(t,i))||N(i,(h=c.current)==null?void 0:h.start,(G=c.current)==null?void 0:G.end)},isDragging:Q,setDragging:W}}function U(a,e){return!a||!e?null:(e.compare(a)<0&&([a,e]=[e,a]),{start:j(a),end:j(e)})}function K(a,e){return a=ne(a,(e==null?void 0:e.calendar)||new re),e&&"hour"in e?e.set(a):a}const Pe=le("div",{width:"fit-content",backgroundColor:"$background",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.08)",borderRadius:"$md",padding:"$4","& .calendar-body":{display:"flex",justifyContent:"space-between",gap:"$2"},"& .calendar-footer":{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"$6",paddingTop:"$6",borderTop:"1px solid $gray40"},"& .calendar-footer .calendar-footer-right-side":{display:"flex",alignItems:"center",gap:"$4"},"& .calendar-footer .preview-date":{margin:0,fontSize:"$body3"},"& .calendar-footer button":{padding:"$1 $2_5",height:"$8",fontSize:"$label2"}}),Be=ce.forwardRef((a,e)=>{var p,y,P;const{state:g,hasFooter:m,css:$={},maxValue:f=te("2999-02-17"),...o}=a,{locale:s}=ie(),r=ye({...o,value:a.state?(p=a.state)==null?void 0:p.value:a.value,visibleDuration:{months:2},locale:s,createCalendar:se}),b=xe(e),{calendarProps:n,prevButtonProps:R,nextButtonProps:l}=pe(o,r,b),x=oe({}),{setIsReset:D}=De(),c=()=>{var t;(t=a.onChange)==null||t.call(a,{start:null,end:null}),D==null||D(!0)},v=()=>{var t;g==null||g.setDateRange({start:M(B()),end:M(B())}),(t=r.setFocusedDate)==null||t.call(r,M(B()))};return F(Pe,{ref:b,css:$,children:[C(he,{state:r,variant:"range",calendarProps:n,prevButtonProps:R,nextButtonProps:l}),F("div",{className:"calendar-body",children:[C(q,{state:r,maxValue:f}),C(q,{state:r,offset:{months:1},maxValue:f})]}),m&&F("div",{className:"calendar-footer",children:[C(J,{variant:"ghost",onPress:c,children:"Clear"}),F("div",{className:"calendar-footer-right-side",children:[C("p",{className:"preview-date",children:((y=r.value)==null?void 0:y.start)&&((P=r.value)==null?void 0:P.end)&&x.formatRange(r.value.start.toDate(B()),r.value.end.toDate(B()))}),C(J,{variant:"primary",onPress:v,children:"Today"})]})]})]})}),Me=Be;export{Me as R};
