import{r as K}from"./index.659ddc59.js";import{d as C,c as N}from"./module.4880accb.js";import{m as z,q as L,$ as I,c as B,j as W,x as q}from"./module.2b24759d.js";import{$ as H,l as j}from"./module.7ec12632.js";import{e as G}from"./real-module.b92d0e18.js";function V(s){return q()?s.altKey:s.ctrlKey}function k(s){return W()?s.metaKey:s.ctrlKey}const Y=1e3;function Z(s){let{keyboardDelegate:e,selectionManager:o,onTypeSelect:c}=s,u=K.exports.useRef({search:"",timeout:null}).current,T=f=>{let b=_(f.key);if(!b||f.ctrlKey||f.metaKey)return;b===" "&&u.search.trim().length>0&&(f.preventDefault(),"continuePropagation"in f||f.stopPropagation()),u.search+=b;let n=e.getKeyForSearch(u.search,o.focusedKey);n==null&&(n=e.getKeyForSearch(u.search)),n!=null&&(o.setFocusedKey(n),c&&c(n)),clearTimeout(u.timeout),u.timeout=setTimeout(()=>{u.search=""},Y)};return{typeSelectProps:{onKeyDownCapture:e.getKeyForSearch?T:null}}}function _(s){return s.length===1||!/^[A-Z]/i.test(s)?s:""}function re(s){let{selectionManager:e,keyboardDelegate:o,ref:c,autoFocus:u=!1,shouldFocusWrap:T=!1,disallowEmptySelection:f=!1,disallowSelectAll:b=!1,selectOnFocus:n=e.selectionBehavior==="replace",disallowTypeAhead:v=!1,shouldUseVirtualFocus:E,allowsTabNavigation:$=!1,isVirtualized:y,scrollRef:a=c}=s,{direction:A}=G(),S=r=>{if(r.altKey&&r.key==="Tab"&&r.preventDefault(),!c.current.contains(r.target))return;const i=(l,w)=>{l!=null&&(e.setFocusedKey(l,w),r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(l):n&&!V(r)&&e.replaceSelection(l))};switch(r.key){case"ArrowDown":if(o.getKeyBelow){var g,d;r.preventDefault();let l=e.focusedKey!=null?o.getKeyBelow(e.focusedKey):(g=o.getFirstKey)===null||g===void 0?void 0:g.call(o);l==null&&T&&(l=(d=o.getFirstKey)===null||d===void 0?void 0:d.call(o,e.focusedKey)),i(l)}break;case"ArrowUp":if(o.getKeyAbove){var F,t;r.preventDefault();let l=e.focusedKey!=null?o.getKeyAbove(e.focusedKey):(F=o.getLastKey)===null||F===void 0?void 0:F.call(o);l==null&&T&&(l=(t=o.getLastKey)===null||t===void 0?void 0:t.call(o,e.focusedKey)),i(l)}break;case"ArrowLeft":if(o.getKeyLeftOf){r.preventDefault();let l=o.getKeyLeftOf(e.focusedKey);i(l,A==="rtl"?"first":"last")}break;case"ArrowRight":if(o.getKeyRightOf){r.preventDefault();let l=o.getKeyRightOf(e.focusedKey);i(l,A==="rtl"?"last":"first")}break;case"Home":if(o.getFirstKey){r.preventDefault();let l=o.getFirstKey(e.focusedKey,k(r));e.setFocusedKey(l),k(r)&&r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(l):n&&e.replaceSelection(l)}break;case"End":if(o.getLastKey){r.preventDefault();let l=o.getLastKey(e.focusedKey,k(r));e.setFocusedKey(l),k(r)&&r.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(l):n&&e.replaceSelection(l)}break;case"PageDown":if(o.getKeyPageBelow){r.preventDefault();let l=o.getKeyPageBelow(e.focusedKey);i(l)}break;case"PageUp":if(o.getKeyPageAbove){r.preventDefault();let l=o.getKeyPageAbove(e.focusedKey);i(l)}break;case"a":k(r)&&e.selectionMode==="multiple"&&b!==!0&&(r.preventDefault(),e.selectAll());break;case"Escape":r.preventDefault(),f||e.clearSelection();break;case"Tab":if(!$){if(r.shiftKey)c.current.focus();else{let l=N(c.current,{tabbable:!0}),w,M;do M=l.lastChild(),M&&(w=M);while(M);w&&!w.contains(document.activeElement)&&B(w)}break}}},h=K.exports.useRef({top:0,left:0});z(a,"scroll",y?null:()=>{h.current={top:a.current.scrollTop,left:a.current.scrollLeft}});let m=r=>{if(e.isFocused){r.currentTarget.contains(r.target)||e.setFocused(!1);return}if(!!r.currentTarget.contains(r.target)){if(e.setFocused(!0),e.focusedKey==null){let d=t=>{t!=null&&(e.setFocusedKey(t),n&&e.replaceSelection(t))},F=r.relatedTarget;var i,g;F&&r.currentTarget.compareDocumentPosition(F)&Node.DOCUMENT_POSITION_FOLLOWING?d((i=e.lastSelectedKey)!==null&&i!==void 0?i:o.getLastKey()):d((g=e.firstSelectedKey)!==null&&g!==void 0?g:o.getFirstKey())}else if(!y){a.current.scrollTop=h.current.top,a.current.scrollLeft=h.current.left;let d=a.current.querySelector(`[data-key="${e.focusedKey}"]`);d&&(B(d),L(a.current,d))}}},x=r=>{r.currentTarget.contains(r.relatedTarget)||e.setFocused(!1)};const P=K.exports.useRef(u);K.exports.useEffect(()=>{if(P.current){let r=null;u==="first"&&(r=o.getFirstKey()),u==="last"&&(r=o.getLastKey());let i=e.selectedKeys;i.size&&(r=i.values().next().value),e.setFocused(!0),e.setFocusedKey(r),r==null&&!E&&C(c.current)}P.current=!1},[]),K.exports.useEffect(()=>{if(!y&&e.focusedKey&&(a==null?void 0:a.current)){let r=a.current.querySelector(`[data-key="${e.focusedKey}"]`);r&&L(a.current,r)}},[y,a,e.focusedKey]);let D={onKeyDown:S,onFocus:m,onBlur:x,onMouseDown(r){a.current===r.target&&r.preventDefault()}},{typeSelectProps:O}=Z({keyboardDelegate:o,selectionManager:e});v||(D=I(O,D));let p;return E||(p=e.focusedKey==null?0:-1),{collectionProps:{...D,tabIndex:p}}}function oe(s){let{selectionManager:e,key:o,ref:c,shouldSelectOnPressUp:u,isVirtualized:T,shouldUseVirtualFocus:f,focus:b,isDisabled:n,onAction:v,allowsDifferentPressOrigin:E}=s,$=t=>{if(t.pointerType==="keyboard"&&V(t))e.toggleSelection(o);else{if(e.selectionMode==="none")return;e.selectionMode==="single"?e.isSelected(o)&&!e.disallowEmptySelection?e.toggleSelection(o):e.replaceSelection(o):t&&t.shiftKey?e.extendSelection(o):e.selectionBehavior==="toggle"||t&&(k(t)||t.pointerType==="touch"||t.pointerType==="virtual")?e.toggleSelection(o):e.replaceSelection(o)}};K.exports.useEffect(()=>{o===e.focusedKey&&e.isFocused&&!f&&document.activeElement!==c.current&&(b?b():C(c.current))},[c,o,e.focusedKey,e.childFocusStrategy,e.isFocused,f]),n=n||e.isDisabled(o);let y={};!f&&!n?y={tabIndex:o===e.focusedKey?0:-1,onFocus(t){t.target===c.current&&e.setFocusedKey(o)}}:n&&(y.onMouseDown=t=>{t.preventDefault()});let a=!n&&e.canSelectItem(o),A=v&&!n,S=A&&(e.selectionBehavior==="replace"?!a:e.isEmpty),h=A&&a&&e.selectionBehavior==="replace",m=S||h,x=K.exports.useRef(null),P=m&&a,D=K.exports.useRef(!1),O=K.exports.useRef(!1),p={};u?(p.onPressStart=t=>{x.current=t.pointerType,D.current=P,t.pointerType==="keyboard"&&(!m||U())&&$(t)},E?(p.onPressUp=t=>{t.pointerType!=="keyboard"&&$(t)},p.onPress=S?()=>v():null):p.onPress=t=>{if(S||h&&t.pointerType!=="mouse"){if(t.pointerType==="keyboard"&&!R())return;v()}else t.pointerType!=="keyboard"&&$(t)}):(p.onPressStart=t=>{x.current=t.pointerType,D.current=P,O.current=S,(t.pointerType==="mouse"&&!S||t.pointerType==="keyboard"&&(!v||U()))&&$(t)},p.onPress=t=>{(t.pointerType==="touch"||t.pointerType==="pen"||t.pointerType==="virtual"||t.pointerType==="keyboard"&&m&&R()||t.pointerType==="mouse"&&O.current)&&(m?v():$(t))}),T||(y["data-key"]=o),p.preventFocusOnPress=f;let{pressProps:r,isPressed:i}=H(p),g=h?t=>{x.current==="mouse"&&(t.stopPropagation(),t.preventDefault(),v())}:void 0,{longPressProps:d}=j({isDisabled:!P,onLongPress(t){t.pointerType==="touch"&&($(t),e.setSelectionBehavior("toggle"))}});return{itemProps:I(y,a||S?r:{},P?d:{},{onDoubleClick:g,onDragStartCapture:t=>{x.current==="touch"&&D.current&&t.preventDefault()}}),isPressed:i,isSelected:e.isSelected(o),isDisabled:n,allowsSelection:a,hasAction:m}}function R(){let s=window.event;return(s==null?void 0:s.key)==="Enter"}function U(){let s=window.event;return(s==null?void 0:s.key)===" "||(s==null?void 0:s.code)==="Space"}export{re as $,oe as a};
