import{r as f}from"./index-07284770.js";import{o as q,z as Y,H as N,E as C,am as j,t as H,X as G,u as X,ae as Z,v as J,W as z,K as Q,an as k,D as _,a as ee}from"./import-315b4a8c.js";import{c as O,d as te,e as le}from"./import-42f643f4.js";function W(r){return k()?r.altKey:r.ctrlKey}function E(r){return _()?r.metaKey:r.ctrlKey}const se=1e3;function ie(r){let{keyboardDelegate:e,selectionManager:t,onTypeSelect:l}=r,s=f.useRef({search:"",timeout:null}).current,a=d=>{let S=oe(d.key);if(!S||d.ctrlKey||d.metaKey)return;S===" "&&s.search.trim().length>0&&(d.preventDefault(),"continuePropagation"in d||d.stopPropagation()),s.search+=S;let u=e.getKeyForSearch(s.search,t.focusedKey);u==null&&(u=e.getKeyForSearch(s.search)),u!=null&&(t.setFocusedKey(u),l&&l(u)),clearTimeout(s.timeout),s.timeout=setTimeout(()=>{s.search=""},se)};return{typeSelectProps:{onKeyDownCapture:e.getKeyForSearch?a:null}}}function oe(r){return r.length===1||!/^[A-Z]/i.test(r)?r:""}function re(r){let{selectionManager:e,keyboardDelegate:t,ref:l,autoFocus:s=!1,shouldFocusWrap:a=!1,disallowEmptySelection:d=!1,disallowSelectAll:S=!1,selectOnFocus:u=e.selectionBehavior==="replace",disallowTypeAhead:p=!1,shouldUseVirtualFocus:x,allowsTabNavigation:m=!1,isVirtualized:g,scrollRef:n=l}=r,{direction:P}=q(),K=o=>{if(o.altKey&&o.key==="Tab"&&o.preventDefault(),!l.current.contains(o.target))return;const h=(c,B)=>{c!=null&&(e.setFocusedKey(c,B),o.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(c):u&&!W(o)&&e.replaceSelection(c))};switch(o.key){case"ArrowDown":if(t.getKeyBelow){var A,$;o.preventDefault();let c=e.focusedKey!=null?t.getKeyBelow(e.focusedKey):(A=t.getFirstKey)===null||A===void 0?void 0:A.call(t);c==null&&a&&(c=($=t.getFirstKey)===null||$===void 0?void 0:$.call(t,e.focusedKey)),h(c)}break;case"ArrowUp":if(t.getKeyAbove){var M,i;o.preventDefault();let c=e.focusedKey!=null?t.getKeyAbove(e.focusedKey):(M=t.getLastKey)===null||M===void 0?void 0:M.call(t);c==null&&a&&(c=(i=t.getLastKey)===null||i===void 0?void 0:i.call(t,e.focusedKey)),h(c)}break;case"ArrowLeft":if(t.getKeyLeftOf){o.preventDefault();let c=t.getKeyLeftOf(e.focusedKey);h(c,P==="rtl"?"first":"last")}break;case"ArrowRight":if(t.getKeyRightOf){o.preventDefault();let c=t.getKeyRightOf(e.focusedKey);h(c,P==="rtl"?"last":"first")}break;case"Home":if(t.getFirstKey){o.preventDefault();let c=t.getFirstKey(e.focusedKey,E(o));e.setFocusedKey(c),E(o)&&o.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(c):u&&e.replaceSelection(c)}break;case"End":if(t.getLastKey){o.preventDefault();let c=t.getLastKey(e.focusedKey,E(o));e.setFocusedKey(c),E(o)&&o.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(c):u&&e.replaceSelection(c)}break;case"PageDown":if(t.getKeyPageBelow){o.preventDefault();let c=t.getKeyPageBelow(e.focusedKey);h(c)}break;case"PageUp":if(t.getKeyPageAbove){o.preventDefault();let c=t.getKeyPageAbove(e.focusedKey);h(c)}break;case"a":E(o)&&e.selectionMode==="multiple"&&S!==!0&&(o.preventDefault(),e.selectAll());break;case"Escape":o.preventDefault(),d||e.clearSelection();break;case"Tab":if(!m){if(o.shiftKey)l.current.focus();else{let c=J(l.current,{tabbable:!0}),B,R;do R=c.lastChild(),R&&(B=R);while(R);B&&!B.contains(document.activeElement)&&z(B)}break}}},v=f.useRef({top:0,left:0});Y(n,"scroll",g?null:()=>{v.current={top:n.current.scrollTop,left:n.current.scrollLeft}});let b=o=>{if(e.isFocused){o.currentTarget.contains(o.target)||e.setFocused(!1);return}if(o.currentTarget.contains(o.target)){if(e.setFocused(!0),e.focusedKey==null){let $=i=>{i!=null&&(e.setFocusedKey(i),u&&e.replaceSelection(i))},M=o.relatedTarget;var h,A;M&&o.currentTarget.compareDocumentPosition(M)&Node.DOCUMENT_POSITION_FOLLOWING?$((h=e.lastSelectedKey)!==null&&h!==void 0?h:t.getLastKey()):$((A=e.firstSelectedKey)!==null&&A!==void 0?A:t.getFirstKey())}else g||(n.current.scrollTop=v.current.top,n.current.scrollLeft=v.current.left);if(!g&&e.focusedKey!=null){let $=n.current.querySelector(`[data-key="${e.focusedKey}"]`);$&&(z($),C(n.current,$))}}},T=o=>{o.currentTarget.contains(o.relatedTarget)||e.setFocused(!1)};const y=f.useRef(s);f.useEffect(()=>{if(y.current){let o=null;s==="first"&&(o=t.getFirstKey()),s==="last"&&(o=t.getLastKey());let h=e.selectedKeys;h.size&&(o=h.values().next().value),e.setFocused(!0),e.setFocusedKey(o),o==null&&!x&&N(l.current)}y.current=!1},[]),f.useEffect(()=>{let o=G();if(!g&&e.isFocused&&e.focusedKey!=null&&(n!=null&&n.current)){let h=n.current.querySelector(`[data-key="${e.focusedKey}"]`);h&&(C(n.current,h),o==="keyboard"&&j(h,{containingElement:l.current}))}},[g,n,e.focusedKey,e.isFocused,l]);let D={onKeyDown:K,onFocus:b,onBlur:T,onMouseDown(o){n.current===o.target&&o.preventDefault()}},{typeSelectProps:I}=ie({keyboardDelegate:t,selectionManager:e});p||(D=H(I,D));let w;return x||(w=e.focusedKey==null?0:-1),{collectionProps:{...D,tabIndex:w}}}function de(r){let{selectionManager:e,key:t,ref:l,shouldSelectOnPressUp:s,isVirtualized:a,shouldUseVirtualFocus:d,focus:S,isDisabled:u,onAction:p,allowsDifferentPressOrigin:x}=r,m=i=>{if(i.pointerType==="keyboard"&&W(i))e.toggleSelection(t);else{if(e.selectionMode==="none")return;e.selectionMode==="single"?e.isSelected(t)&&!e.disallowEmptySelection?e.toggleSelection(t):e.replaceSelection(t):i&&i.shiftKey?e.extendSelection(t):e.selectionBehavior==="toggle"||i&&(E(i)||i.pointerType==="touch"||i.pointerType==="virtual")?e.toggleSelection(t):e.replaceSelection(t)}};f.useEffect(()=>{t===e.focusedKey&&e.isFocused&&!d&&(S?S():document.activeElement!==l.current&&N(l.current))},[l,t,e.focusedKey,e.childFocusStrategy,e.isFocused,d]),u=u||e.isDisabled(t);let g={};!d&&!u?g={tabIndex:t===e.focusedKey?0:-1,onFocus(i){i.target===l.current&&e.setFocusedKey(t)}}:u&&(g.onMouseDown=i=>{i.preventDefault()});let n=!u&&e.canSelectItem(t),P=p&&!u,K=P&&(e.selectionBehavior==="replace"?!n:e.isEmpty),v=P&&n&&e.selectionBehavior==="replace",b=K||v,T=f.useRef(null),y=b&&n,D=f.useRef(!1),I=f.useRef(!1),w={};s?(w.onPressStart=i=>{T.current=i.pointerType,D.current=y,i.pointerType==="keyboard"&&(!b||U())&&m(i)},x?(w.onPressUp=i=>{i.pointerType!=="keyboard"&&m(i)},w.onPress=K?()=>p():null):w.onPress=i=>{if(K||v&&i.pointerType!=="mouse"){if(i.pointerType==="keyboard"&&!V())return;p()}else i.pointerType!=="keyboard"&&m(i)}):(w.onPressStart=i=>{T.current=i.pointerType,D.current=y,I.current=K,(i.pointerType==="mouse"&&!K||i.pointerType==="keyboard"&&(!p||U()))&&m(i)},w.onPress=i=>{(i.pointerType==="touch"||i.pointerType==="pen"||i.pointerType==="virtual"||i.pointerType==="keyboard"&&b&&V()||i.pointerType==="mouse"&&I.current)&&(b?p():m(i))}),a||(g["data-key"]=t),w.preventFocusOnPress=d;let{pressProps:o,isPressed:h}=X(w),A=v?i=>{T.current==="mouse"&&(i.stopPropagation(),i.preventDefault(),p())}:void 0,{longPressProps:$}=Z({isDisabled:!y,onLongPress(i){i.pointerType==="touch"&&(m(i),e.setSelectionBehavior("toggle"))}});return{itemProps:H(g,n||K?o:{},y?$:{},{onDoubleClick:A,onDragStartCapture:i=>{T.current==="touch"&&D.current&&i.preventDefault()}}),isPressed:h,isSelected:e.isSelected(t),isFocused:e.isFocused&&e.focusedKey===t,isDisabled:u,allowsSelection:n,hasAction:b}}function V(){let r=window.event;return(r==null?void 0:r.key)==="Enter"}function U(){let r=window.event;return(r==null?void 0:r.key)===" "||(r==null?void 0:r.code)==="Space"}class ce{getKeyBelow(e){for(e=this.collection.getKeyAfter(e);e!=null;){if(this.collection.getItem(e).type==="item"&&!this.disabledKeys.has(e))return e;e=this.collection.getKeyAfter(e)}return null}getKeyAbove(e){for(e=this.collection.getKeyBefore(e);e!=null;){if(this.collection.getItem(e).type==="item"&&!this.disabledKeys.has(e))return e;e=this.collection.getKeyBefore(e)}return null}getFirstKey(){let e=this.collection.getFirstKey();for(;e!=null;){if(this.collection.getItem(e).type==="item"&&!this.disabledKeys.has(e))return e;e=this.collection.getKeyAfter(e)}return null}getLastKey(){let e=this.collection.getLastKey();for(;e!=null;){if(this.collection.getItem(e).type==="item"&&!this.disabledKeys.has(e))return e;e=this.collection.getKeyBefore(e)}return null}getItem(e){return this.ref.current.querySelector(`[data-key="${e}"]`)}getKeyPageAbove(e){let t=this.ref.current,l=this.getItem(e);if(!l)return null;let s=Math.max(0,l.offsetTop+l.offsetHeight-t.offsetHeight);for(;l&&l.offsetTop>s;)e=this.getKeyAbove(e),l=e==null?null:this.getItem(e);return e}getKeyPageBelow(e){let t=this.ref.current,l=this.getItem(e);if(!l)return null;let s=Math.min(t.scrollHeight,l.offsetTop-l.offsetHeight+t.offsetHeight);for(;l&&l.offsetTop<s;)e=this.getKeyBelow(e),l=e==null?null:this.getItem(e);return e}getKeyForSearch(e,t){if(!this.collator)return null;let l=this.collection,s=t||this.getFirstKey();for(;s!=null;){let a=l.getItem(s),d=a.textValue.slice(0,e.length);if(a.textValue&&this.collator.compare(d,e)===0)return s;s=this.getKeyBelow(s)}return null}constructor(e,t,l,s){this.collection=e,this.disabledKeys=t,this.ref=l,this.collator=s}}function he(r){let{selectionManager:e,collection:t,disabledKeys:l,ref:s,keyboardDelegate:a,autoFocus:d,shouldFocusWrap:S,isVirtualized:u,disallowEmptySelection:p,selectOnFocus:x=e.selectionBehavior==="replace",disallowTypeAhead:m,shouldUseVirtualFocus:g,allowsTabNavigation:n}=r,P=Q({usage:"search",sensitivity:"base"}),K=e.disabledBehavior,v=f.useMemo(()=>a||new ce(t,K==="selection"?new Set:l,s,P),[a,t,l,s,P,K]),{collectionProps:b}=re({ref:s,selectionManager:e,keyboardDelegate:v,autoFocus:d,shouldFocusWrap:S,disallowEmptySelection:p,selectOnFocus:x,disallowTypeAhead:m,shouldUseVirtualFocus:g,allowsTabNavigation:n,isVirtualized:u,scrollRef:s});return{listProps:b}}class F extends Set{constructor(e,t,l){super(e),e instanceof F?(this.anchorKey=t||e.anchorKey,this.currentKey=l||e.currentKey):(this.anchorKey=t,this.currentKey=l)}}function ne(r,e){if(r.size!==e.size)return!1;for(let t of r)if(!e.has(t))return!1;return!0}function ye(r){let{selectionMode:e="none",disallowEmptySelection:t,allowDuplicateSelectionEvents:l,selectionBehavior:s="toggle",disabledBehavior:a="all"}=r,d=f.useRef(!1),[,S]=f.useState(!1),u=f.useRef(null),p=f.useRef(null),[,x]=f.useState(null),m=f.useMemo(()=>L(r.selectedKeys),[r.selectedKeys]),g=f.useMemo(()=>L(r.defaultSelectedKeys,new F),[r.defaultSelectedKeys]),[n,P]=ee(m,g,r.onSelectionChange),K=f.useMemo(()=>r.disabledKeys?new Set(r.disabledKeys):new Set,[r.disabledKeys]),[v,b]=f.useState(s);s==="replace"&&v==="toggle"&&typeof n=="object"&&n.size===0&&b("replace");let T=f.useRef(s);return f.useEffect(()=>{s!==T.current&&(b(s),T.current=s)},[s]),{selectionMode:e,disallowEmptySelection:t,selectionBehavior:v,setSelectionBehavior:b,get isFocused(){return d.current},setFocused(y){d.current=y,S(y)},get focusedKey(){return u.current},get childFocusStrategy(){return p.current},setFocusedKey(y,D="first"){u.current=y,p.current=D,x(y)},selectedKeys:n,setSelectedKeys(y){(l||!ne(y,n))&&P(y)},disabledKeys:K,disabledBehavior:a}}function L(r,e){return r?r==="all"?"all":new F(r):e}class ge{get selectionMode(){return this.state.selectionMode}get disallowEmptySelection(){return this.state.disallowEmptySelection}get selectionBehavior(){return this.state.selectionBehavior}setSelectionBehavior(e){this.state.setSelectionBehavior(e)}get isFocused(){return this.state.isFocused}setFocused(e){this.state.setFocused(e)}get focusedKey(){return this.state.focusedKey}get childFocusStrategy(){return this.state.childFocusStrategy}setFocusedKey(e,t){(e==null||this.collection.getItem(e))&&this.state.setFocusedKey(e,t)}get selectedKeys(){return this.state.selectedKeys==="all"?new Set(this.getSelectAllKeys()):this.state.selectedKeys}get rawSelection(){return this.state.selectedKeys}isSelected(e){return this.state.selectionMode==="none"?!1:(e=this.getKey(e),this.state.selectedKeys==="all"?this.canSelectItem(e):this.state.selectedKeys.has(e))}get isEmpty(){return this.state.selectedKeys!=="all"&&this.state.selectedKeys.size===0}get isSelectAll(){if(this.isEmpty)return!1;if(this.state.selectedKeys==="all")return!0;if(this._isSelectAll!=null)return this._isSelectAll;let e=this.getSelectAllKeys(),t=this.state.selectedKeys;return this._isSelectAll=e.every(l=>t.has(l)),this._isSelectAll}get firstSelectedKey(){let e=null;for(let t of this.state.selectedKeys){let l=this.collection.getItem(t);(!e||l&&O(this.collection,l,e)<0)&&(e=l)}return e==null?void 0:e.key}get lastSelectedKey(){let e=null;for(let t of this.state.selectedKeys){let l=this.collection.getItem(t);(!e||l&&O(this.collection,l,e)>0)&&(e=l)}return e==null?void 0:e.key}get disabledKeys(){return this.state.disabledKeys}get disabledBehavior(){return this.state.disabledBehavior}extendSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"){this.replaceSelection(e);return}e=this.getKey(e);let t;if(this.state.selectedKeys==="all")t=new F([e],e,e);else{let l=this.state.selectedKeys,s=l.anchorKey||e;t=new F(l,s,e);for(let a of this.getKeyRange(s,l.currentKey||e))t.delete(a);for(let a of this.getKeyRange(e,s))this.canSelectItem(a)&&t.add(a)}this.state.setSelectedKeys(t)}getKeyRange(e,t){let l=this.collection.getItem(e),s=this.collection.getItem(t);return l&&s?O(this.collection,l,s)<=0?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){let l=[],s=e;for(;s;){let a=this.collection.getItem(s);if((a&&a.type==="item"||a.type==="cell"&&this.allowsCellSelection)&&l.push(s),s===t)return l;s=this.collection.getKeyAfter(s)}return[]}getKey(e){let t=this.collection.getItem(e);if(!t||t.type==="cell"&&this.allowsCellSelection)return e;for(;t.type!=="item"&&t.parentKey!=null;)t=this.collection.getItem(t.parentKey);return!t||t.type!=="item"?null:t.key}toggleSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"&&!this.isSelected(e)){this.replaceSelection(e);return}if(e=this.getKey(e),e==null)return;let t=new F(this.state.selectedKeys==="all"?this.getSelectAllKeys():this.state.selectedKeys);t.has(e)?t.delete(e):this.canSelectItem(e)&&(t.add(e),t.anchorKey=e,t.currentKey=e),!(this.disallowEmptySelection&&t.size===0)&&this.state.setSelectedKeys(t)}replaceSelection(e){if(this.selectionMode==="none"||(e=this.getKey(e),e==null))return;let t=this.canSelectItem(e)?new F([e],e,e):new F;this.state.setSelectedKeys(t)}setSelectedKeys(e){if(this.selectionMode==="none")return;let t=new F;for(let l of e)if(l=this.getKey(l),l!=null&&(t.add(l),this.selectionMode==="single"))break;this.state.setSelectedKeys(t)}getSelectAllKeys(){let e=[],t=l=>{for(;l;){if(this.canSelectItem(l)){let s=this.collection.getItem(l);s.type==="item"&&e.push(l),s.hasChildNodes&&(this.allowsCellSelection||s.type!=="item")&&t(te(le(s,this.collection)).key)}l=this.collection.getKeyAfter(l)}};return t(this.collection.getFirstKey()),e}selectAll(){this.selectionMode==="multiple"&&this.state.setSelectedKeys("all")}clearSelection(){!this.disallowEmptySelection&&(this.state.selectedKeys==="all"||this.state.selectedKeys.size>0)&&this.state.setSelectedKeys(new F)}toggleSelectAll(){this.isSelectAll?this.clearSelection():this.selectAll()}select(e,t){this.selectionMode!=="none"&&(this.selectionMode==="single"?this.isSelected(e)&&!this.disallowEmptySelection?this.toggleSelection(e):this.replaceSelection(e):this.selectionBehavior==="toggle"||t&&(t.pointerType==="touch"||t.pointerType==="virtual")?this.toggleSelection(e):this.replaceSelection(e))}isSelectionEqual(e){if(e===this.state.selectedKeys)return!0;let t=this.selectedKeys;if(e.size!==t.size)return!1;for(let l of e)if(!t.has(l))return!1;for(let l of t)if(!e.has(l))return!1;return!0}canSelectItem(e){if(this.state.selectionMode==="none"||this.state.disabledKeys.has(e))return!1;let t=this.collection.getItem(e);return!(!t||t.type==="cell"&&!this.allowsCellSelection)}isDisabled(e){return this.state.disabledKeys.has(e)&&this.state.disabledBehavior==="all"}constructor(e,t,l){this.collection=e,this.state=t;var s;this.allowsCellSelection=(s=l==null?void 0:l.allowsCellSelection)!==null&&s!==void 0?s:!1,this._isSelectAll=null}}export{ce as $,ie as a,ye as b,ge as c,he as d,de as e,re as f};
