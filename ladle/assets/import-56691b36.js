import{_ as C}from"./_define_property-1764bf98.js";import{r as $,R as g}from"./index-63360bd1.js";import{$ as P,r as B,s as A,e as x,t as W}from"./import-c5521a7a.js";import{f as z,g as j,h as _,b as q,i as H,e as U}from"./import-fd958c92.js";function I(t){if(U()==="virtual"){let e=document.activeElement;B(()=>{document.activeElement===e&&document.contains(t)&&A(t)})}else A(t)}function G(t){if(!(t instanceof HTMLElement)&&!(t instanceof SVGElement))return!1;let{display:e,visibility:r}=t.style,n=e!=="none"&&r!=="hidden"&&r!=="collapse";if(n){const{getComputedStyle:c}=t.ownerDocument.defaultView;let{display:o,visibility:i}=c(t);n=o!=="none"&&i!=="hidden"&&i!=="collapse"}return n}function J(t,e){return!t.hasAttribute("hidden")&&(t.nodeName==="DETAILS"&&e&&e.nodeName!=="SUMMARY"?t.hasAttribute("open"):!0)}function V(t,e){return t.nodeName!=="#comment"&&G(t)&&J(t,e)&&(!t.parentElement||V(t.parentElement,t))}const K=g.createContext(null);let d=null;function le(t){let{children:e,contain:r,restoreFocus:n,autoFocus:c}=t,o=$.useRef(),i=$.useRef(),a=$.useRef([]),{parentNode:u}=$.useContext(K)||{},l=$.useMemo(()=>new R({scopeRef:a}),[a]);x(()=>{let f=u||b.root;if(b.getTreeNode(f.scopeRef)&&d&&!w(d,f.scopeRef)){let m=b.getTreeNode(d);m&&(f=m)}f.addChild(l),b.addNode(l)},[l,u]),x(()=>{let f=b.getTreeNode(a);f.contain=r},[r]),x(()=>{let f=o.current.nextSibling,m=[];for(;f&&f!==i.current;)m.push(f),f=f.nextSibling;a.current=m},[e]),ee(a,n,r),Z(a,r),re(a,n,r),O(a,c),$.useEffect(()=>{if(a){let f=document.activeElement,m=null;if(p(f,a.current)){for(let T of b.traverse())p(f,T.scopeRef.current)&&(m=T);m===b.getTreeNode(a)&&(d=m.scopeRef)}return()=>{let T=b.getTreeNode(a).parent.scopeRef;(a===d||w(a,d))&&(!T||b.getTreeNode(T))&&(d=T),b.removeTreeNode(a)}}},[a]);let s=$.useMemo(()=>Y(a),[]),v=$.useMemo(()=>({focusManager:s,parentNode:l}),[l,s]);return g.createElement(K.Provider,{value:v},g.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:o}),e,g.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:i}))}function Y(t){return{focusNext(e={}){let r=t.current,{from:n,tabbable:c,wrap:o,accept:i}=e,a=n||document.activeElement,u=r[0].previousElementSibling,l=h(N(r),{tabbable:c,accept:i},r);l.currentNode=p(a,r)?a:u;let s=l.nextNode();return!s&&o&&(l.currentNode=u,s=l.nextNode()),s&&E(s,!0),s},focusPrevious(e={}){let r=t.current,{from:n,tabbable:c,wrap:o,accept:i}=e,a=n||document.activeElement,u=r[r.length-1].nextElementSibling,l=h(N(r),{tabbable:c,accept:i},r);l.currentNode=p(a,r)?a:u;let s=l.previousNode();return!s&&o&&(l.currentNode=u,s=l.previousNode()),s&&E(s,!0),s},focusFirst(e={}){let r=t.current,{tabbable:n,accept:c}=e,o=h(N(r),{tabbable:n,accept:c},r);o.currentNode=r[0].previousElementSibling;let i=o.nextNode();return i&&E(i,!0),i},focusLast(e={}){let r=t.current,{tabbable:n,accept:c}=e,o=h(N(r),{tabbable:n,accept:c},r);o.currentNode=r[r.length-1].nextElementSibling;let i=o.previousNode();return i&&E(i,!0),i}}}const k=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],Q=k.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";k.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const X=k.join(':not([hidden]):not([tabindex="-1"]),');function N(t){return t[0].parentElement}function F(t){let e=b.getTreeNode(d);for(;e&&e.scopeRef!==t;){if(e.contain)return!1;e=e.parent}return!0}function Z(t,e){let r=$.useRef(),n=$.useRef(null);x(()=>{let c=t.current;if(!e){n.current&&(cancelAnimationFrame(n.current),n.current=null);return}let o=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!F(t))return;let l=document.activeElement,s=t.current;if(!p(l,s))return;let v=h(N(s),{tabbable:!0},s);v.currentNode=l;let f=u.shiftKey?v.previousNode():v.nextNode();f||(v.currentNode=u.shiftKey?s[s.length-1].nextElementSibling:s[0].previousElementSibling,f=u.shiftKey?v.previousNode():v.nextNode()),u.preventDefault(),f&&E(f,!0)},i=u=>{(!d||w(d,t))&&p(u.target,t.current)?(d=t,r.current=u.target):F(t)&&!y(u.target,t)?r.current?r.current.focus():d&&S(d.current):F(t)&&(r.current=u.target)},a=u=>{n.current&&cancelAnimationFrame(n.current),n.current=requestAnimationFrame(()=>{F(t)&&!y(document.activeElement,t)&&(d=t,document.body.contains(u.target)?(r.current=u.target,r.current.focus()):d&&S(d.current))})};return document.addEventListener("keydown",o,!1),document.addEventListener("focusin",i,!1),c.forEach(u=>u.addEventListener("focusin",i,!1)),c.forEach(u=>u.addEventListener("focusout",a,!1)),()=>{document.removeEventListener("keydown",o,!1),document.removeEventListener("focusin",i,!1),c.forEach(u=>u.removeEventListener("focusin",i,!1)),c.forEach(u=>u.removeEventListener("focusout",a,!1))}},[t,e]),$.useEffect(()=>()=>{n.current&&cancelAnimationFrame(n.current)},[n])}function D(t){return y(t)}function p(t,e){return e.some(r=>r.contains(t))}function y(t,e=null){if(t instanceof Element&&t.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:r}of b.traverse(b.getTreeNode(e)))if(p(t,r.current))return!0;return!1}function se(t){return y(t,d)}function w(t,e){var r;let n=(r=b.getTreeNode(e))===null||r===void 0?void 0:r.parent;for(;n;){if(n.scopeRef===t)return!0;n=n.parent}return!1}function E(t,e=!1){if(t!=null&&!e)try{I(t)}catch{}else if(t!=null)try{t.focus()}catch{}}function S(t,e=!0){let r=t[0].previousElementSibling,n=h(N(t),{tabbable:e},t);n.currentNode=r;let c=n.nextNode();e&&!c&&(n=h(N(t),{tabbable:!1},t),n.currentNode=r,c=n.nextNode()),E(c)}function O(t,e){const r=g.useRef(e);$.useEffect(()=>{r.current&&(d=t,p(document.activeElement,d.current)||S(t.current)),r.current=!1},[t])}function ee(t,e,r){x(()=>{if(e||r)return;let n=t.current,c=o=>{let i=o.target;p(i,t.current)?d=t:D(i)||(d=null)};return document.addEventListener("focusin",c,!1),n.forEach(o=>o.addEventListener("focusin",c,!1)),()=>{document.removeEventListener("focusin",c,!1),n.forEach(o=>o.removeEventListener("focusin",c,!1))}},[t,e,r])}function te(t){let e=b.getTreeNode(d);for(;e&&e.scopeRef!==t;){if(e.nodeToRestore)return!1;e=e.parent}return(e==null?void 0:e.scopeRef)===t}function re(t,e,r){const n=$.useRef(typeof document<"u"?document.activeElement:null);x(()=>{let c=t.current;if(!e||r)return;let o=()=>{(!d||w(d,t))&&(d=t)};return document.addEventListener("focusin",o,!1),c.forEach(i=>i.addEventListener("focusin",o,!1)),()=>{document.removeEventListener("focusin",o,!1),c.forEach(i=>i.removeEventListener("focusin",o,!1))}},[t,r]),x(()=>{if(!e)return;b.getTreeNode(t).nodeToRestore=n.current;let c=o=>{if(o.key!=="Tab"||o.altKey||o.ctrlKey||o.metaKey)return;let i=document.activeElement;if(!p(i,t.current))return;let a=b.getTreeNode(t).nodeToRestore,u=h(document.body,{tabbable:!0});u.currentNode=i;let l=o.shiftKey?u.previousNode():u.nextNode();if((!document.body.contains(a)||a===document.body)&&(a=null,b.getTreeNode(t).nodeToRestore=null),(!l||!p(l,t.current))&&a){u.currentNode=a;do l=o.shiftKey?u.previousNode():u.nextNode();while(p(l,t.current));o.preventDefault(),o.stopPropagation(),l?E(l,!0):D(a)?E(a,!0):i.blur()}};return r||document.addEventListener("keydown",c,!0),()=>{r||document.removeEventListener("keydown",c,!0);let o=b.getTreeNode(t).nodeToRestore;if(e&&o&&(p(document.activeElement,t.current)||document.activeElement===document.body&&te(t))){let i=b.clone();requestAnimationFrame(()=>{if(document.activeElement===document.body){let a=i.getTreeNode(t);for(;a;){if(a.nodeToRestore&&document.body.contains(a.nodeToRestore)){E(a.nodeToRestore);return}a=a.parent}for(a=i.getTreeNode(t);a;){if(a.scopeRef&&b.getTreeNode(a.scopeRef)){S(a.scopeRef.current,!0);return}a=a.parent}}})}}},[t,e,r])}function h(t,e,r){let n=e!=null&&e.tabbable?X:Q,c=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode(o){var i;return!(e==null||(i=e.from)===null||i===void 0)&&i.contains(o)?NodeFilter.FILTER_REJECT:o.matches(n)&&V(o)&&(!r||p(o,r))&&(!(e!=null&&e.accept)||e.accept(o))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return e!=null&&e.from&&(c.currentNode=e.from),c}function de(t,e={}){return{focusNext(r={}){let n=t.current;if(!n)return;let{from:c,tabbable:o=e.tabbable,wrap:i=e.wrap,accept:a=e.accept}=r,u=c||document.activeElement,l=h(n,{tabbable:o,accept:a});n.contains(u)&&(l.currentNode=u);let s=l.nextNode();return!s&&i&&(l.currentNode=n,s=l.nextNode()),s&&E(s,!0),s},focusPrevious(r=e){let n=t.current;if(!n)return;let{from:c,tabbable:o=e.tabbable,wrap:i=e.wrap,accept:a=e.accept}=r,u=c||document.activeElement,l=h(n,{tabbable:o,accept:a});if(n.contains(u))l.currentNode=u;else{let v=L(l);return v&&E(v,!0),v}let s=l.previousNode();return!s&&i&&(l.currentNode=n,s=L(l)),s&&E(s,!0),s},focusFirst(r=e){let n=t.current;if(!n)return;let{tabbable:c=e.tabbable,accept:o=e.accept}=r,a=h(n,{tabbable:c,accept:o}).nextNode();return a&&E(a,!0),a},focusLast(r=e){let n=t.current;if(!n)return;let{tabbable:c=e.tabbable,accept:o=e.accept}=r,i=h(n,{tabbable:c,accept:o}),a=L(i);return a&&E(a,!0),a}}}function L(t){let e,r;do r=t.lastChild(),r&&(e=r);while(r);return e}class M{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,r,n){let c=this.fastMap.get(r??null),o=new R({scopeRef:e});c.addChild(o),o.parent=c,this.fastMap.set(e,o),n&&(o.nodeToRestore=n)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let r=this.fastMap.get(e),n=r.parent;for(let o of this.traverse())o!==r&&r.nodeToRestore&&o.nodeToRestore&&r.scopeRef.current&&p(o.nodeToRestore,r.scopeRef.current)&&(o.nodeToRestore=r.nodeToRestore);let c=r.children;n.removeChild(r),c.size>0&&c.forEach(o=>n.addChild(o)),this.fastMap.delete(r.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let r of e.children)yield*this.traverse(r)}clone(){let e=new M;for(let r of this.traverse())e.addTreeNode(r.scopeRef,r.parent.scopeRef,r.nodeToRestore);return e}constructor(){C(this,"fastMap",new Map),this.root=new R({scopeRef:null}),this.fastMap.set(null,this.root)}}class R{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){C(this,"children",new Set),C(this,"contain",!1),this.scopeRef=e.scopeRef}}let b=new M;function fe(t={}){let{autoFocus:e=!1,isTextInput:r,within:n}=t,c=$.useRef({isFocused:!1,isFocusVisible:e||z()}),[o,i]=$.useState(!1),[a,u]=$.useState(()=>c.current.isFocused&&c.current.isFocusVisible),l=$.useCallback(()=>u(c.current.isFocused&&c.current.isFocusVisible),[]),s=$.useCallback(m=>{c.current.isFocused=m,i(m),l()},[l]);j(m=>{c.current.isFocusVisible=m,l()},[],{isTextInput:r});let{focusProps:v}=_({isDisabled:n,onFocusChange:s}),{focusWithinProps:f}=q({isDisabled:!n,onFocusWithinChange:s});return{isFocused:o,isFocusVisible:c.current.isFocused&&a,focusProps:n?f:v}}let ne=g.createContext(null);function oe(t){let e=$.useContext(ne)||{};W(e,t);let{ref:r,...n}=e;return n}function be(t,e){let{focusProps:r}=_(t),{keyboardProps:n}=H(t),c=P(r,n),o=oe(e),i=t.isDisabled?{}:o,a=$.useRef(t.autoFocus);return $.useEffect(()=>{a.current&&e.current&&I(e.current),a.current=!1},[e]),{focusableProps:P({...c,tabIndex:t.excludeFromTabOrder&&!t.isDisabled?-1:void 0},i)}}export{de as $,h as a,I as b,fe as c,be as d,le as e,se as f};
