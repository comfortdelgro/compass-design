import{s as $,j as o,a as j,r as s,F as he,R as Re}from"./index-4f639d7a.js";import"./index-a4fa3985.js";import{C as Le}from"./components-4ae9f9ca.js";import{x as Me,y as $e,z as De,A as Be,B as He,C as Oe}from"./index-bbc6e670.js";import{l as ue}from"./lodash-a137db1e.js";import{B as V}from"./index-32ba2c4d.js";import{I as ge}from"./index-0450e891.js";import{T as Fe}from"./index-8df5f1d8.js";import"./index.es-d62ae1d4.js";import{S as We}from"./index-04dc9f66.js";import{B as ae}from"./button-13e47faa.js";import"./use-dom-ref-172c1966.js";import"./keyframes-55535cf2.js";var c=(e=>(e[e.zoomIn=1]="zoomIn",e[e.zoomOut=2]="zoomOut",e[e.prev=3]="prev",e[e.next=4]="next",e[e.rotateLeft=5]="rotateLeft",e[e.rotateRight=6]="rotateRight",e[e.reset=7]="reset",e[e.close=8]="close",e[e.scaleX=9]="scaleX",e[e.scaleY=10]="scaleY",e))(c||{}),h=(e=>(e.setVisible="setVisible",e.setActiveIndex="setActiveIndex",e.update="update",e.clear="clear",e))(h||{});const je=84,Ve=$("div",{appearance:"none",border:"none",boxSizing:"border-box",margin:"0px",zIndex:"51",backgroundColor:"rgba(0, 0, 0, 0.4)",position:"fixed",top:0,left:0,overflow:"hidden",width:"100vw",height:"100vh"}),Ne=$("div",{zIndex:"52",position:"fixed",marginBottom:20,top:20,left:0,display:"flex",flexDirection:"row",width:"100vw",alignItems:"center",justifyContent:"center"}),Ke=$("div",{zIndex:"52",position:"fixed",bottom:60,left:0,display:"flex",width:"100vw",alignItems:"center",justifyContent:"center"}),Pe=$("div",{display:"flex",width:"100vw",alignItems:"center",justifyContent:"center"}),Ge=$("div",{zIndex:52,position:"fixed",height:50,bottom:0,left:0,display:"flex",alignItems:"center",justifyContent:"center",width:"100vw"}),qe=$("div",{zIndex:53,height:50,marginBottom:10,img:{width:"60px",height:"50px",opacity:.5,marginRight:2,marginLeft:2,borderRadius:4},".active":{opacity:1,border:"2px solid $cdgBlue80"}});function Ze(e){return o(Ke,{children:j(Fe.Label,{css:{textAlign:"center"},variant:"label1",children:[e.alt&&`${e.alt} `,`(${e.width} x ${e.height}) `,o("b",{children:`${e.activeIndex+1} ${e.totalName} ${e.count}`})]})})}function Ue(e){const r=s.useRef(!1),m=s.useRef({x:0,y:0}),[l,d]=s.useState({x:0,y:0});s.useEffect(()=>()=>{H(!0),B(!0)},[]),s.useEffect(()=>(B(),()=>{B(!0)})),s.useEffect(()=>(e.visible&&e.drag&&H(),!e.visible&&e.drag&&K(),()=>{H(!0)}),[e.drag,e.visible]),s.useEffect(()=>{const f=l.x-m.current.x,I=l.y-m.current.y;m.current={x:l.x,y:l.y},e.onChangeImgState(e.width,e.height,e.top+I,e.left+f)},[l]);function D(){e.onResize()}function U(f){e.onCanvasMouseDown(f),N(f)}function N(f){f.button===0&&(!e.visible||!e.drag||(f.preventDefault(),f.stopPropagation(),r.current=!0,m.current={x:f.nativeEvent.clientX,y:f.nativeEvent.clientY}))}const _=f=>{r.current&&d({x:f.clientX,y:f.clientY})};function K(){r.current=!1}function B(f){let I="addEventListener";f&&(I="removeEventListener"),window[I]("resize",D,!1)}function H(f){let I="addEventListener";f&&(I="removeEventListener"),document[I]("click",K,!1),document[I]("mousemove",_,!1)}const J={width:`${e.width}px`,height:`${e.height}px`,transform:`translateX(${e.left!==null?`${e.left}px`:"aoto"}) translateY(${e.top}px)
    rotate(${e.rotate}deg) scaleX(${e.scaleX}) scaleY(${e.scaleY})`};let X=null;return e.imgSrc!==""&&(X=o("img",{src:e.imgSrc,style:J,onMouseDown:N})),e.loading&&(X=o(V,{css:{display:"flex",height:`${window.innerHeight-84}px`,justifyContent:"center",alignItems:"center"},children:o(We,{size:"2xl"})})),o(V,{onMouseDown:U,css:{zIndex:e.zIndex},children:X})}function _e(e){const{activeIndex:r=0}=e;function m(l){r!==l&&e.onChangeImg(l)}return o(Ge,{children:e.images.map((l,d)=>o(qe,{onClick:()=>{m(d)},children:o("img",{className:d===r?"active":"",src:l.src,alt:l.alt})},d))})}const Je=[{key:"zoomIn",actionType:c.zoomIn,icon:Me},{key:"reset",actionType:c.reset,icon:$e},{key:"zoomOut",actionType:c.zoomOut,icon:De},{key:"prev",actionType:c.prev,icon:Be},{key:"next",actionType:c.next,icon:He}];function Z(e,r){return e.filter(l=>r.indexOf(l.key)<0)}function Qe(e){function r(d){e.onAction(d)}function m(d){return o(ae,{variant:"ghost",onClick:()=>{r(d)},"data-key":d.key,children:d.icon?o(ge,{icon:d.icon,color:"white"}):o(he,{children:d.key})},d.key)}let l=e.toolbars;return e.zoomable||(l=Z(l,["zoomIn","zoomOut"])),e.changeable||(l=Z(l,["prev","next"])),e.rotatable||(l=Z(l,["rotateLeft","rotateRight"])),e.scalable||(l=Z(l,["scaleX","scaleY"])),o(Ne,{children:o(Pe,{children:l.map(d=>m(d))})})}function b(e,r){return{type:e,payload:r||{}}}const Te=e=>{var se;const{visible:r=!1,onClose:m=ue.noop,images:l=[],activeIndex:d=0,zIndex:D=55,drag:U=!0,zoomable:N=!0,rotatable:_=!0,scalable:K=!0,onMaskClick:B=ue.noop,changeable:H=!0,customToolbar:J=t=>t,zoomSpeed:X=.05,disableKeyboardSupport:f=!1,noResetZoomAfterChange:I=!1,noLimitInitializationSize:me=!1,defaultScale:L=1,loop:ve=!0,disableMouseZoom:be=!1,isShowImageInformation:xe=!0,isShowToolbar:we=!0,isShowPreview:Ie=!0,totalName:ye="of",minScale:P=.1}=e,Se={index:0,visible:!1,visibleStart:!1,transitionEnd:!1,activeIndex:e.activeIndex??0,width:0,height:0,top:15,left:0,rotate:0,imageWidth:0,imageHeight:0,scaleX:L,scaleY:L,loading:!1,loadFailed:!1,startLoading:!1};function Q(){let t=window.innerWidth,n=window.innerHeight;return e.container&&(t=e.container.offsetWidth,n=e.container.offsetHeight),{width:t,height:n}}const x=s.useRef(Q()),G=je;function ze(t,n){switch(n.type){case h.setVisible:return{...t,visible:!!n.payload.visible};case h.setActiveIndex:return{...t,activeIndex:Number(n.payload.index),startLoading:!0};case h.update:return{...t,...n.payload};case h.clear:return{...t,width:0,height:0,scaleX:L,scaleY:L,rotate:1,imageWidth:0,imageHeight:0,loadFailed:!1,top:0,left:0,loading:!1}}return t}const O=s.useRef(null),F=s.useRef(!1),ie=s.useRef(0),[a,v]=s.useReducer(ze,Se);s.useEffect(()=>(F.current=!0,()=>{F.current=!1}),[]),s.useEffect(()=>{x.current=Q()},[e.container]),s.useEffect(()=>{r&&F.current&&v(b(h.setVisible,{visible:!0}))},[r]),s.useEffect(()=>(f||document.addEventListener("keydown",oe,!0),O.current&&O.current.addEventListener("wheel",ce,!1),()=>{document.removeEventListener("keydown",oe,!0),O.current&&O.current.removeEventListener("wheel",ce,!1)})),s.useEffect(()=>{r&&v(b(h.setActiveIndex,{index:d}))},[d,r,l]);function T(t,n=!1){v(b(h.update,{loading:!0,loadFailed:!1}));let i={src:"",alt:""};l.length>0&&(i=l[t]);let u=!1;const g=new Image;g.onload=()=>{F.current&&(u||w(g.width,g.height,!0))},g.onerror=()=>{if(F.current)if(e.defaultImg){v(b(h.update,{loading:!1,loadFailed:!0,startLoading:!1}));const M=e.defaultImg.width||x.current.width*.5,k=e.defaultImg.height||x.current.height*.5;w(M,k,!1)}else v(b(h.update,{loading:!1,loadFailed:!1,startLoading:!1}))},g.src=i.src,g.complete&&(u=!0,w(g.width,g.height,!0));function w(M,k,W){if(t!==ie.current)return;let E=M,R=k;e.defaultSize&&(E=e.defaultSize.width,R=e.defaultSize.height),i.defaultSize&&(E=i.defaultSize.width,R=i.defaultSize.height);const[y,S]=ne(E,R),z=(x.current.width-y)/2,C=(x.current.height-S-G)/2;let de=L,fe=L;I&&!n&&(de=a.scaleX,fe=a.scaleY),v(b(h.update,{width:y,height:S,left:z,top:C,imageWidth:M,imageHeight:k,loading:!1,rotate:0,scaleX:de,scaleY:fe,loadFailed:!W,startLoading:!1}))}}s.useEffect(()=>{a.startLoading&&(ie.current=a.activeIndex,T(a.activeIndex))},[a.startLoading,a.activeIndex]);function ne(t,n){let i=0,u=0;const g=x.current.width*.8,w=(x.current.height-G)*.8;return i=Math.min(g,t),u=i/t*n,u>w&&(u=w,i=u/n*t),me&&(i=t,u=n),[i,u]}function A(t){if(!(!ve&&(t>=l.length||t<0))&&(t>=l.length&&(t=0),t<0&&(t=l.length-1),t!==a.activeIndex)){if(e.onChange){const n=p(t);e.onChange(n,t)}v(b(h.setActiveIndex,{index:t}))}}function p(t){let n={src:"",alt:""},i=null;return t!==void 0?i=t:i=a.activeIndex,l.length>0&&i>=0&&(n=l[i]),n}function Ce(t){v(b(h.update,{scaleX:a.scaleX*t}))}function ke(t){v(b(h.update,{scaleY:a.scaleY*t}))}function le(t=!1){v(b(h.update,{rotate:a.rotate+90*(t?1:-1)}))}function Y(t){switch(t){case c.prev:A(a.activeIndex-1);break;case c.next:A(a.activeIndex+1);break;case c.zoomIn:const n=ee();te(n.x,n.y,1,X);break;case c.zoomOut:const i=ee();te(i.x,i.y,-1,X);break;case c.rotateLeft:le();break;case c.rotateRight:le(!0);break;case c.reset:T(a.activeIndex,!0);break;case c.scaleX:Ce(-1);break;case c.scaleY:ke(-1);break}}function re(t){if(Y(t.actionType),t.onClick){const n=p();t.onClick(n)}}function Xe(t,n,i,u){v(b(h.update,{width:t,height:n,top:i,left:u}))}function Ye(){if(x.current=Q(),r){const t=(x.current.width-a.width)/2,n=(x.current.height-a.height-G)/2;v(b(h.update,{left:t,top:n}))}}function Ee(t){B(t)}function oe(t){const n=t.keyCode||t.which||t.charCode;let i=!1;switch(n){case 27:m(),i=!0;break;case 37:t.ctrlKey?Y(c.rotateLeft):Y(c.prev),i=!0;break;case 39:t.ctrlKey?Y(c.rotateRight):Y(c.next),i=!0;break;case 38:Y(c.zoomIn),i=!0;break;case 40:Y(c.zoomOut),i=!0;break;case 49:t.ctrlKey&&(T(a.activeIndex),i=!0);break}i&&(t.preventDefault(),t.stopPropagation())}function ce(t){if(be||a.loading)return;t.preventDefault();let n=0;const i=t.deltaY;if(i===0?n=0:n=i>0?-1:1,n!==0){let u=t.clientX,g=t.clientY;if(e.container){const w=e.container.getBoundingClientRect();u-=w.left,g-=w.top}te(u,g,n,X)}}function ee(){return{x:a.left+a.width/2,y:a.top+a.height/2}}function te(t,n,i,u){const g=ee(),w=t-g.x,M=n-g.y;let k=0,W=0,E=0,R=0,y=0,S=0;if(a.width===0){const[z,C]=ne(a.imageWidth,a.imageHeight);W=(x.current.width-z)/2,k=(x.current.height-G-C)/2,E=a.width+z,R=a.height+C,y=S=1}else{const z=a.scaleX>0?1:-1,C=a.scaleY>0?1:-1;y=a.scaleX+u*i*z,S=a.scaleY+u*i*C,typeof e.maxScale<"u"&&(Math.abs(y)>e.maxScale&&(y=e.maxScale*z),Math.abs(S)>e.maxScale&&(S=e.maxScale*C)),Math.abs(y)<P&&(y=P*z),Math.abs(S)<P&&(S=P*C),k=a.top+-i*M/a.scaleX*u*z,W=a.left+-i*w/a.scaleY*u*C,E=a.width,R=a.height}v(b(h.update,{width:E,scaleX:y,scaleY:S,height:R,top:k,left:W,loading:!1}))}let q={src:"",alt:""};return r&&a.visible&&!a.loading&&a.activeIndex!==null&&!a.startLoading&&(q=p()),o(he,{children:r&&j(Ve,{children:[e.noClose||o(ae,{variant:"ghost",css:{right:0,top:0,position:"absolute",zIndex:60},onClick:m,children:o(ge,{icon:Oe,color:"white"})}),j(V,{onTransitionEnd:()=>{r||v(b(h.setVisible,{visible:!1}))},ref:O,children:[o(V,{css:{zIndex:D}}),o(Ue,{imgSrc:a.loadFailed&&((se=e==null?void 0:e.defaultImg)==null?void 0:se.src)||q.src,visible:r,width:a.width,height:a.height,top:a.top,left:a.left,rotate:a.rotate,onChangeImgState:Xe,onResize:Ye,zIndex:D+5,scaleX:a.scaleX,scaleY:a.scaleY,loading:a.loading,drag:U,container:e.container,onCanvasMouseDown:Ee}),j(V,{css:{zIndex:D+5},children:[we&&o(Qe,{onAction:re,zoomable:N,rotatable:_,scalable:K,changeable:H,toolbars:J(Je)}),xe&&o(Ze,{onAction:re,alt:q.alt??"",width:a.imageWidth,height:a.imageHeight,activeIndex:a.activeIndex,count:l.length,totalName:ye}),Ie&&o(_e,{images:e.images,activeIndex:a.activeIndex,onChangeImg:A})]})]})]})})},Ae=e=>{const[r,m]=s.useState(!1);return s.useEffect(()=>{e.visible&&!r&&m(!0)},[e.visible,r]),r?o(Te,{...e}):null},ut=()=>{const[e,r]=Re.useState(!1);return j(Le,{children:[o("h3",{children:"Default "}),o(ae,{onClick:()=>r(!0),children:"Open"}),o(Ae,{visible:e,onClose:()=>{r(!1)},images:[{src:"https://cdn.arstechnica.net/wp-content/uploads/2020/09/macOSBigSur.jpg",alt:"image 1"},{src:"https://images.hdqwalls.com/wallpapers/iridescence-big-sur-dt.jpg",alt:"image 2"},{src:"https://wallpapers.com/images/hd/macos-big-sur-layers-0vz216diu4sn9qaq.jpg",alt:"image 2"},{src:"https://rare-gallery.com/mocahbig/429176-abstract-gradient-Big-Sur-macOS-macOS-Big-Sur-shapes.jpg",alt:"image 2"}]})]})};typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{ut as Default};
