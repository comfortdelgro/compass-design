import{b as T,y as Y,z as ee,D as O,e as ne,i as ae,d as re,$ as te,m as se,k as ie,G}from"./import-0e52c6a7.js";import{r as b,s as oe,R as le,a as I,j as x}from"./index-e285302b.js";import"./index-76d34920.js";import{b as ce,y as Z,l as ue,t as de,d as fe,B as be,z as ge,i as A,D as H,E as ve,F as me,C as $e,A as _}from"./useCalendarState-72159f9a.js";import{u as De,a as B}from"./useEvent-9e5a4e9a.js";import{u as pe}from"./use-dom-ref-58648911.js";import{B as q}from"./button-1deb7e4d.js";function Re(a,e){var D,c,R,h;const o=ce(a);if(e.visibleRange==null)return{};const m=Z(e.visibleRange.start,e.timeZone??"UTC"),$=Z(e.visibleRange.start,e.timeZone??"UTC"),f=De([!!a.errorMessage,a.validationState]);ue.set(e,{ariaLabel:a["aria-label"]??"",ariaLabelledBy:a["aria-labelledby"],errorMessageId:f});const l=b.useRef(!1),t=a.isDisabled||((D=e.isNextVisibleRangeInvalid)==null?void 0:D.call(e));t&&l.current&&(l.current=!1,(c=e.setFocused)==null||c.call(e,!0));const i=b.useRef(!1),g=a.isDisabled||((R=e.isPreviousVisibleRangeInvalid)==null?void 0:R.call(e));g&&i.current&&(i.current=!1,(h=e.setFocused)==null||h.call(e,!0));const n=de({id:a.id,"aria-label":[a["aria-label"],$].filter(Boolean).join(", "),"aria-labelledby":a["aria-labelledby"]});return{calendarProps:{...o,...n,role:"group","aria-describedby":a["aria-describedby"]||void 0},nextButtonProps:{onPress:()=>{var u;return(u=e.focusNextPage)==null?void 0:u.call(e)},"aria-label":"next",isDisabled:t,onFocus:()=>l.current=!0,onBlur:()=>l.current=!1},prevButtonProps:{onPress:()=>{var u;return(u=e.focusPreviousPage)==null?void 0:u.call(e)},"aria-label":"previous",isDisabled:g,onFocus:()=>i.current=!0,onBlur:()=>i.current=!1},title:m}}function he(a,e,o){const m=Re(a,e),$=b.useRef(!1),f=b.useRef(typeof window<"u"?window:null);B(f,"pointerdown",t=>{$.current=t.width===0&&t.height===0});const l=t=>{var n;if($.current){$.current=!1;return}if(e.setDragging(!1),!e.anchorDate)return;const i=t.target,g=document.getElementById(m.calendarProps.id);g&&g.contains(document.activeElement)&&(!g.contains(i)||!i.closest('button, [role="button"]'))&&((n=e.selectFocusedDate)==null||n.call(e))};return B(f,"pointerup",l),B(f,"pointercancel",l),m.calendarProps.onBlur=t=>{var i;(!t.relatedTarget||!o.current.contains(t.relatedTarget))&&e.anchorDate&&((i=e.selectFocusedDate)==null||i.call(e))},B(o,"touchmove",t=>{e.isDragging&&t.preventDefault()},{passive:!1,capture:!0}),m}function xe(a){var E,z,V,k;const{value:e,defaultValue:o,onChange:m,createCalendar:$,locale:f,visibleDuration:l={months:1},minValue:t,maxValue:i,...g}=a,[n,D]=fe(e,o||null,m),[c,R]=b.useState(null);let h="center";if(n&&n.start&&n.end){const d=be(T(n.start),l,f,t,i).add(l).subtract({days:1});n.end.compare(d)>0&&(h="start")}const u=b.useRef(null),[v,C]=b.useState(),U=b.useMemo(()=>Y(t,v==null?void 0:v.start),[t,v]),j=b.useMemo(()=>ee(i,v==null?void 0:v.end),[i,v]),s=ge({...g,value:n&&n.start,createCalendar:$,locale:f,visibleDuration:l,minValue:U,maxValue:j,selectionAlignment:h}),S=r=>{r&&a.isDateUnavailable&&!a.allowsNonContiguousRanges?(u.current={start:H(r,s,-1),end:H(r,s,1)},C(u.current)):(u.current=null,C(void 0))},w=b.useRef(s.visibleRange);(!O((E=s.visibleRange)==null?void 0:E.start,(z=w.current)==null?void 0:z.start)||!O((V=s.visibleRange)==null?void 0:V.end,(k=w.current)==null?void 0:k.end))&&(S(c),w.current=s.visibleRange);const F=r=>{r?(R(r),S(r)):(R(null),S(null))},y=c?M(c,s.focusedDate):n&&M(n.start,n.end),N=r=>{var d;if(!a.isReadOnly&&(r=ve(r,U,j),r=me(r,(d=s.visibleRange)==null?void 0:d.start,a.isDateUnavailable),!!r))if(!c)F(r);else{const p=M(c,r);D({start:J(p.start,n==null?void 0:n.start),end:J(p.end,n==null?void 0:n.end)}),F(null)}},[K,Q]=b.useState(!1),{isDateUnavailable:P}=a,W=b.useMemo(()=>!n||c?!1:P&&(P(n.start)||P(n.end))?!0:A(n.start,t,i)||A(n.end,t,i),[P,n,c,t,i]),X=a.validationState||(W?"invalid":null);return{...s,value:n,setValue:D,anchorDate:c,setAnchorDate:F,highlightedRange:y,validationState:X,selectFocusedDate(){N(s.focusedDate)},selectDate:N,highlightDate(r){var d;c&&((d=s.setFocusedDate)==null||d.call(s,r))},isSelected(r){var d,p;return y&&r.compare(y.start)>=0&&r.compare(y.end)<=0&&!((d=s.isCellDisabled)!=null&&d.call(s,r))&&!((p=s.isCellUnavailable)!=null&&p.call(s,r))},isInvalid(r){var d,p,L;return((d=s.isInvalid)==null?void 0:d.call(s,r))||A(r,(p=u.current)==null?void 0:p.start,(L=u.current)==null?void 0:L.end)},isDragging:K,setDragging:Q}}function M(a,e){return!a||!e?null:(e.compare(a)<0&&([a,e]=[e,a]),{start:T(a),end:T(e)})}function J(a,e){return a=ne(a,(e==null?void 0:e.calendar)||new ae),e&&"hour"in e?e.set(a):a}const Ce=oe("div",{width:"fit-content",backgroundColor:"$background",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.08)",borderRadius:"$md",padding:"$4","& .calendar-body":{display:"flex",justifyContent:"space-between",gap:"$2"},"& .calendar-footer":{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"$2",marginTop:"$6",paddingTop:"$6",borderTop:"1px solid $gray40"},"& .calendar-footer .preview-date":{margin:0,fontSize:"$body3"},"& .calendar-footer button":{padding:"$1 $2_5",height:"$8",fontSize:"$label2"}}),ye=le.forwardRef((a,e)=>{const{state:o,hasFooter:m,css:$={},onCancelCallback:f,onApplyCallback:l,maxValue:t=re("2999-02-17"),...i}=a,{locale:g}=te(),n=xe({...i,visibleDuration:{months:2},locale:g,createCalendar:se}),D=pe(e),{calendarProps:c,prevButtonProps:R,nextButtonProps:h}=he(i,n,D),u=ie({}),v=()=>{f==null||f(),o==null||o.close()},C=()=>{o&&(l==null||l(o.value)),o==null||o.close()};return I(Ce,{ref:D,css:$,children:[x($e,{state:n,variant:"range",calendarProps:c,prevButtonProps:R,nextButtonProps:h}),I("div",{className:"calendar-body",children:[x(_,{state:n,maxValue:t}),x(_,{state:n,offset:{months:1},maxValue:t})]}),m&&I("div",{className:"calendar-footer",children:[x("p",{className:"preview-date",children:n.value&&u.formatRange(n.value.start.toDate(G()),n.value.end.toDate(G()))}),x(q,{variant:"ghost",onPress:v,children:"Cancel"}),x(q,{variant:"primary",onPress:C,children:"Apply"})]})]})}),Me=ye;export{Me as R};
