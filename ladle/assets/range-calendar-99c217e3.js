import{b as j,A as ee,B as ae,F as H,e as ne,i as re,d as te,$ as se,m as ie,k as oe,w as S,v as M}from"./import-1a869848.js";import{r as d,s as le,R as ce,a as I,j as p}from"./index-2a259d11.js";import"./index-58d00a4c.js";import{b as ue,A as Z,l as de,v as fe,d as be,G as ge,B as ve,i as N,H as J,I as me,J as $e,o as De,E as he,F as _}from"./useCalendarState-03afca74.js";import{u as Re,a as T}from"./useEvent-84b7c289.js";import{u as xe}from"./use-dom-ref-c21a8ae3.js";import{B as q}from"./button-7e26b5e4.js";function Ce(a,e){var R,l,x,D;const f=ue(a);if(e.visibleRange==null)return{};const m=Z(e.visibleRange.start,e.timeZone??"UTC"),$=Z(e.visibleRange.start,e.timeZone??"UTC"),b=Re([!!a.errorMessage,a.validationState]);de.set(e,{ariaLabel:a["aria-label"]??"",ariaLabelledBy:a["aria-labelledby"],errorMessageId:b});const o=d.useRef(!1),i=a.isDisabled||((R=e.isNextVisibleRangeInvalid)==null?void 0:R.call(e));i&&o.current&&(o.current=!1,(l=e.setFocused)==null||l.call(e,!0));const n=d.useRef(!1),g=a.isDisabled||((x=e.isPreviousVisibleRangeInvalid)==null?void 0:x.call(e));g&&n.current&&(n.current=!1,(D=e.setFocused)==null||D.call(e,!0));const r=fe({id:a.id,"aria-label":[a["aria-label"],$].filter(Boolean).join(", "),"aria-labelledby":a["aria-labelledby"]});return{calendarProps:{...f,...r,role:"group","aria-describedby":a["aria-describedby"]||void 0},nextButtonProps:{onPress:()=>{var c;return(c=e.focusNextPage)==null?void 0:c.call(e)},"aria-label":"next",isDisabled:i,onFocus:()=>o.current=!0,onBlur:()=>o.current=!1},prevButtonProps:{onPress:()=>{var c;return(c=e.focusPreviousPage)==null?void 0:c.call(e)},"aria-label":"previous",isDisabled:g,onFocus:()=>n.current=!0,onBlur:()=>n.current=!1},title:m}}function pe(a,e,f){const m=Ce(a,e),$=d.useRef(!1),b=d.useRef(typeof window<"u"?window:null);T(b,"pointerdown",i=>{$.current=i.width===0&&i.height===0});const o=i=>{var r;if($.current){$.current=!1;return}if(e.setDragging(!1),!e.anchorDate)return;const n=i.target,g=document.getElementById(m.calendarProps.id);g&&g.contains(document.activeElement)&&(!g.contains(n)||!n.closest('button, [role="button"]'))&&((r=e.selectFocusedDate)==null||r.call(e))};return T(b,"pointerup",o),T(b,"pointercancel",o),m.calendarProps.onBlur=i=>{var n;(!i.relatedTarget||!f.current.contains(i.relatedTarget))&&e.anchorDate&&((n=e.selectFocusedDate)==null||n.call(e))},T(f,"touchmove",i=>{e.isDragging&&i.preventDefault()},{passive:!1,capture:!0}),m}function ye(a){var V,L,O,z;const{value:e,defaultValue:f,onChange:m,createCalendar:$,locale:b,visibleDuration:o={months:1},minValue:i,maxValue:n,...g}=a,[r,R]=be(e,f||null,m),[l,x]=d.useState(null);let D="center";if(r&&r.start&&r.end){const u=ge(j(r.start),o,b,i,n).add(o).subtract({days:1});r.end.compare(u)>0&&(D="start")}const c=d.useRef(null),[v,y]=d.useState(),P=d.useMemo(()=>ee(i,v==null?void 0:v.start),[i,v]),B=d.useMemo(()=>ae(n,v==null?void 0:v.end),[n,v]),t=ve({...g,value:r&&r.start,createCalendar:$,locale:b,visibleDuration:o,minValue:P,maxValue:B,selectionAlignment:D}),C=s=>{s&&a.isDateUnavailable&&!a.allowsNonContiguousRanges?(c.current={start:J(s,t,-1),end:J(s,t,1)},y(c.current)):(c.current=null,y(void 0))},k=d.useRef(t.visibleRange);(!H((V=t.visibleRange)==null?void 0:V.start,(L=k.current)==null?void 0:L.start)||!H((O=t.visibleRange)==null?void 0:O.end,(z=k.current)==null?void 0:z.end))&&(C(l),k.current=t.visibleRange);const A=s=>{s?(x(s),C(s)):(x(null),C(null))},w=l?U(l,t.focusedDate):r&&U(r.start,r.end),E=s=>{var u;if(!a.isReadOnly&&(s=me(s,P,B),s=$e(s,(u=t.visibleRange)==null?void 0:u.start,a.isDateUnavailable),!!s))if(!l)A(s);else{const h=U(l,s);R({start:K(h.start,r==null?void 0:r.start),end:K(h.end,r==null?void 0:r.end)}),A(null)}},[Q,W]=d.useState(!1),{isDateUnavailable:F}=a,X=d.useMemo(()=>!r||l?!1:F&&(F(r.start)||F(r.end))?!0:N(r.start,i,n)||N(r.end,i,n),[F,r,l,i,n]),Y=a.validationState||(X?"invalid":null);return{...t,value:r,setValue:R,anchorDate:l,setAnchorDate:A,highlightedRange:w,validationState:Y,selectFocusedDate(){E(t.focusedDate)},selectDate:E,highlightDate(s){var u;l&&((u=t.setFocusedDate)==null||u.call(t,s))},isSelected(s){var u,h;return w&&s.compare(w.start)>=0&&s.compare(w.end)<=0&&!((u=t.isCellDisabled)!=null&&u.call(t,s))&&!((h=t.isCellUnavailable)!=null&&h.call(t,s))},isInvalid(s){var u,h,G;return((u=t.isInvalid)==null?void 0:u.call(t,s))||N(s,(h=c.current)==null?void 0:h.start,(G=c.current)==null?void 0:G.end)},isDragging:Q,setDragging:W}}function U(a,e){return!a||!e?null:(e.compare(a)<0&&([a,e]=[e,a]),{start:j(a),end:j(e)})}function K(a,e){return a=ne(a,(e==null?void 0:e.calendar)||new re),e&&"hour"in e?e.set(a):a}const Pe=le("div",{width:"fit-content",backgroundColor:"$background",boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.08)",borderRadius:"$md",padding:"$4","& .calendar-body":{display:"flex",justifyContent:"space-between",gap:"$2"},"& .calendar-footer":{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"$6",paddingTop:"$6",borderTop:"1px solid $gray40"},"& .calendar-footer .calendar-footer-right-side":{display:"flex",alignItems:"center",gap:"$4"},"& .calendar-footer .preview-date":{margin:0,fontSize:"$body3"},"& .calendar-footer button":{padding:"$1 $2_5",height:"$8",fontSize:"$label2"}}),Be=ce.forwardRef((a,e)=>{var y,P,B;const{state:f,hasFooter:m,css:$={},maxValue:b=te("2999-02-17"),...o}=a,{locale:i}=se(),n=ye({...o,value:a.state?(y=a.state)==null?void 0:y.value:a.value,visibleDuration:{months:2},locale:i,createCalendar:ie}),g=xe(e),{calendarProps:r,prevButtonProps:R,nextButtonProps:l}=pe(o,n,g),x=oe({}),{setIsReset:D}=De(),c=()=>{var t;(t=a.onChange)==null||t.call(a,{start:null,end:null}),D==null||D(!0)},v=()=>{var C;const t={start:M(S()),end:M(S())};f?f==null||f.setDateRange(t):n.setValue(t),(C=n.setFocusedDate)==null||C.call(n,M(S()))};return I(Pe,{ref:g,css:$,children:[p(he,{state:n,variant:"range",calendarProps:r,prevButtonProps:R,nextButtonProps:l}),I("div",{className:"calendar-body",children:[p(_,{state:n,maxValue:b}),p(_,{state:n,offset:{months:1},maxValue:b})]}),m&&I("div",{className:"calendar-footer",children:[p(q,{variant:"ghost",onPress:c,children:"Clear"}),I("div",{className:"calendar-footer-right-side",children:[p("p",{className:"preview-date",children:((P=n.value)==null?void 0:P.start)&&((B=n.value)==null?void 0:B.end)&&x.formatRange(n.value.start.toDate(S()),n.value.end.toDate(S()))}),p(q,{variant:"primary",onPress:v,children:"Today"})]})]})]})}),Me=Be;export{Me as R};
