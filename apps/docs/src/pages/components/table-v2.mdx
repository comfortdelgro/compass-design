import {Callout} from 'nextra-theme-docs'
import styles from '../../styles/Home.module.css'
import {faThumbsUp, faVirus} from '@fortawesome/free-solid-svg-icons'
import {
  ReactTableFullFeature,
  ReactTableBasic,
  EditableCellTable,
  ExpandableColumnTable,
} from 'components/TableV2'

# Table-v2

Table version 2 is a wrapper around the core table logic. Most of its job is related to managing state the "react" way, providing types and the rendering implementation of cell/header/footer templates.

Provided appears to be a React component called ReactTable which is a table component built base on the @tanstack/react-table library. It accepts various props to customize its behavior and rendering.

<Callout>
  Check out our [ladle](/ladle?story=table-v2--full-featured) for more info on
  this component.
</Callout>

---

### Import

```js
import {ReactTable} from '@comfortdelgro/react-compass'
```

or

```js
import ReactTable from '@comfortdelgro/react-compass/table-v2'
```

---

### Basic table v2

<section className={styles.componentShowcaseContainer}>
  <ReactTableBasic />
</section>

```tsx
const columns = React.useMemo<Array<ColumnConfig<Person>>>(
  () => [
    {
      id: 'name',
      header: () => <div style={{textAlign: 'center'}}>Name</div>,
      footer: (props) => props.column.id,
      columns: [
        {
          accessorKey: 'firstName',
          cell: (info) => info.getValue<string>(),
          footer: (props) => props.column.id,
          enableResizing: false,
          enableColumnFilter: false,
        },
        {
          accessorFn: (row) => row.lastName,
          id: 'lastName',
          cell: (info) => info.getValue<string>(),
          header: () => <span>Last Name</span>,
          footer: (props) => props.column.id,
          enableResizing: false,
          enableColumnFilter: false,
          enableGrouping: false,
        },
      ],
    },
    {
      id: 'otherInfo',
      header: () => <div style={{textAlign: 'center'}}>Other info</div>,
      footer: (props) => props.column.id,
      columns: [
        {
          accessorKey: 'age',
          header: () => 'Age',
          footer: (info) => info.column.id,
          enableColumnFilter: false,
        },
        {
          accessorKey: 'visits',
          header: () => <span>Visits</span>,
          footer: (info) => info.column.id,
          enableColumnFilter: false,
        },
        {
          accessorKey: 'status',
          header: 'Status',
          footer: (info) => info.column.id,
          enableColumnFilter: false,
        },
        {
          accessorKey: 'progress',
          header: 'Profile Progress',
          cell: (info) => info.getValue<string>(),
          footer: (info) => info.column.id,
          enableColumnFilter: false,
        },
      ],
    },
  ],
  [],
)
```

```js
<ReactTable data={data} columns={columns} options={options}>
  <ReactTable.Toolbar
    css={{
      display: 'flex',
      flexDirection: 'row',
      justifyContent: 'space-between',
    }}
  >
    <SearchField placeholder='Search' />

    <div
      style={{
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        gap: '0.5rem',
      }}
    >
      <Button variant='primary'>Button</Button>
      <Button variant='secondary'>Button</Button>
      <Button variant='ghost'>
        <Icon icon={faTrashAlt} />
      </Button>
      <Button variant='ghost'>
        <Icon icon={faDashboard} />
      </Button>
      <Button variant='ghost'>
        <Icon icon={faFileLines} />
      </Button>
    </div>
  </ReactTable.Toolbar>
  <ReactTable.Footer
    css={{
      display: 'flex',
      flexDirection: 'row',
      justifyContent: 'space-between',
    }}
  >
    <div>{/* Todo: Dropdown */}</div>
    <div
      style={{
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        gap: '0.5rem',
      }}
    >
      <div
        style={{
          fontWeight: '600',
        }}
      >
        {(page - 1) * 10 + 1} - {(page - 1) * 10 + 10} of 100
      </div>
      <Pagination page={page} onChange={(page) => setPage(page)} total={10} />
    </div>
  </ReactTable.Footer>
</ReactTable>
```

### Data

#### data: TData[]

The data for the table to display. This array should match the type you provided to `table.setRowType<...>`, but in theory could be an array of anything.
It's common for each item in the array to be an object of key/values but this is not required. Columns can access this data via string/index or a functional accessor to return anything they want.

When the data option changes reference (compared via Object.is), the table will reprocess the data.
Any other data processing that relies on the core data model (such as grouping, sorting, filtering, etc) will also be reprocessed.

Make sure your data option is only changing when you want the table to reprocess.
Providing an inline [] or constructing the data array as a new object every time you want to render the table will result in a lot of unnecessary re-processing.
This can easily go unnoticed in smaller tables, but you will likely notice it in larger tables.

### Options Interface

The `Options` interface represents the configuration options for a particular functionality or component.

#### Properties

| Property             | Type                                      | Description                                                                                                 |
| -------------------- | ----------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| `enableSorting`      | `boolean`                                 | A boolean value indicating whether sorting is enabled. Defaults to `false` if not provided.                 |
| `enableMultiSort`    | `boolean`                                 | A boolean value indicating whether multiple column sorting is enabled. Defaults to `false` if not provided. |
| `manualSorting`      | `boolean`                                 | A boolean value indicating whether manual sorting is enabled. Defaults to `false` if not provided.          |
| `columnResizeMode`   | `'onChange' \| 'onEnd'`                   | A string value specifying the column resize mode.                                                           |
| `initialSortBy`      | `SortingState`                            | A `SortingState` object representing the initial sorting configuration.                                     |
| `enableRowSelection` | `boolean \| (row: Row<TData>) => boolean` | A boolean value or a function determining whether row selection is enabled.                                 |

#### SortingState

The `SortingState` interface represents the sorting configuration.

##### Properties

| Property    | Type              | Description                                   |
| ----------- | ----------------- | --------------------------------------------- |
| `column`    | `string`          | The column to sort by.                        |
| `direction` | `'asc' \| 'desc'` | The sort direction (ascending or descending). |

#### `Row<TData>`

The `Row` interface represents a specific row.

##### Properties

#### Example Usage

```tsx
interface SortingState {
  column: string
  direction: 'asc' | 'desc'
}

interface Row<TData> {
  // Properties of a row
}

interface Options<TData> {
  enableSorting?: boolean
  enableMultiSort?: boolean
  manualSorting?: boolean
  columnResizeMode?: 'onChange' | 'onEnd'
  initialSortBy?: SortingState
  enableRowSelection?: boolean | ((row: Row<TData>) => boolean)
}
```

### Full features

<section className={styles.componentShowcaseContainer}>
  <ReactTableFullFeature />
</section>

```tsx
const columns = React.useMemo<Array<TableV2ColumnDef<Person>>>(
  () => [
    {
      id: 'select',
      header: ({table}) => {
        return (
          <div
            style={{
              display: 'flex',
              justifyContent: 'center',
              alignItems: 'center',
            }}
          >
            <ReactTable.CheckboxCell
              checked={table.getIsAllRowsSelected()}
              indeterminate={table.getIsSomeRowsSelected()}
              onChange={table.getToggleAllRowsSelectedHandler()}
            />
          </div>
        )
      },
      cell: ({row}) => (
        <div
          style={{
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <ReactTable.CheckboxCell
            disabled={!row.getCanSelect()}
            checked={row.getIsSelected()}
            indeterminate={row.getIsSomeSelected()}
            onChange={row.getToggleSelectedHandler()}
          />
        </div>
      ),
    },
    {
      id: 'name',
      header: () => <div style={{textAlign: 'center'}}>Name</div>,
      footer: (props) => props.column.id,
      enableGrouping: false,
      columns: [
        {
          accessorKey: 'firstName',
          cell: (info) => info.getValue<string>(),
          header: () => <span>First Name</span>,
          footer: (props) => props.column.id,
          enableResizing: true,
          enableGrouping: false,
          sortDescriptor: 'asc',
          meta: {
            editable: true,
            updateData: (rowIndex: number, id: string, value: any) => {
              setData((old: Person[]) =>
                old.map((row, index) => {
                  if (index === rowIndex) {
                    return {
                      ...old[rowIndex],
                      [id]: value,
                    } as Person
                  }
                  return row
                }),
              )
            },
          },
        },
        {
          accessorFn: (row) => row.lastName,
          id: 'lastName',
          cell: (info) => info.getValue<string>(),
          header: () => <span>Last Name</span>,
          footer: (props) => props.column.id,
          enableResizing: true,
        },
      ],
    },
    {
      id: 'otherInfo',
      header: () => <div style={{textAlign: 'center'}}>Other info</div>,
      footer: (props) => props.column.id,
      enableGrouping: false,
      columns: [
        {
          accessorKey: 'age',
          header: () => 'Age',
          footer: (info) => info.column.id,
        },
        {
          accessorKey: 'visits',
          header: () => <span>Visits</span>,
          footer: (info) => info.column.id,
        },
        {
          accessorKey: 'status',
          header: 'Status',
          footer: (info) => info.column.id,
        },
        {
          accessorKey: 'progress',
          header: 'Profile Progress',
          cell: (info) => info.getValue<string>(),
          footer: (info) => info.column.id,
        },
      ],
    },
  ],
  [],
)
```

```js
<ReactTable
  data={data}
  columns={columns}
  options={options}
  onManualSorting={onSorting}
>
  <ReactTable.Toolbar
    css={{
      display: 'flex',
      flexDirection: 'row',
      justifyContent: 'space-between',
    }}
  >
    <SearchField placeholder='Search' />

    <div
      style={{
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        gap: '0.5rem',
      }}
    >
      <Button variant='primary' className='c-hKssGC-hYGuEl-variant-primary'>
        Button
      </Button>
      <Button variant='secondary'>Button</Button>
      <Button variant='ghost'>
        <Icon icon={faTrashAlt} />
      </Button>
      <Button variant='ghost'>
        <Icon icon={faDashboard} />
      </Button>
      <Button variant='ghost'>
        <Icon icon={faFileLines} />
      </Button>
    </div>
  </ReactTable.Toolbar>
  <ReactTable.Footer
    css={{
      display: 'flex',
      flexDirection: 'row',
      justifyContent: 'space-between',
    }}
  >
    <div>{/* Todo: Dropdown */}</div>
    <div
      style={{
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        gap: '0.5rem',
      }}
    >
      <div
        style={{
          fontWeight: '600',
        }}
      >
        {(page - 1) * 10 + 1} - {(page - 1) * 10 + 10} of 100
      </div>
      <Pagination page={page} onChange={(page) => setPage(page)} total={10} />
    </div>
  </ReactTable.Footer>
</ReactTable>
```

---

### Usage

#### For server sorting

\*if user want to custom sort. Add `manualSorting: true` to ReactTableOptions.

```js
const options: ReactTableOptions = {
  enableSorting: true,
  enableMultiSort: true,
  columnResizeMode: 'onChange',
  manualSorting: true,
}
```

\*then create function and assign to `onManualSorting` props on ReactTable.

Example

```js
const onSorting = (sortingField: TableV2SortingState) => {
  console.log('stateSorting', sortingField)
}
```

```js
 <ReactTable data={data} columns={columns} options={options} onManualSorting={onSorting}>
```

\*props `sortingField` contain all informations sorting for your need

---

#### For rows Selection

The `enableRowSelection` property determines whether row selection is enabled within a component or functionality.
It can be assigned a boolean value or a function that takes a `Row` object representing a specific row and returns a boolean value indicating whether the row is selectable.

- When set to `true`, row selection is enabled for all rows within the component or functionality.
- When set to `false`, row selection is disabled for all rows.

Alternatively, you can provide a custom function to control row selection on a per-row basis.
The function receives a `Row` object as its argument, allowing you to define custom logic to determine if a specific row should be selectable.
The function should return `true` if the row is selectable and `false` if it's not.

##### Type Definition

```typescript
type Row<TData> = {
  // Properties of a row
}

type EnableRowSelectionFn<TData> = (row: Row<TData>) => boolean

interface Options<TData> {
  enableRowSelection?: boolean | EnableRowSelectionFn<TData>
}
```

#### For custom style

\*add className to ReactTable

```js
<ReactTable
  data={data}
  columns={columns}
  options={options}
  onManualSorting={onSorting}
  className='someClassName'
>
```

- options property of table-v2:

```js
const options: OptionType = {
  enableSorting?: boolean
  enableMultiSort?: boolean
  manualSorting?: boolean
  columnResizeMode?: 'onChange' | 'onEnd'
}
```

#### ColumnConfig

Column definitions are plain objects with the following options:

##### Enable Resizing

| Name             | Type    | Default | Description            |
| :--------------- | :------ | :------ | :--------------------- |
| `enableResizing` | boolean | `false` | `Enable column resize` |

##### Enable column filter

| Name                 | Type    | Default | Description            |
| :------------------- | :------ | :------ | :--------------------- |
| `enableColumnFilter` | boolean | `false` | `Enable column filter` |

##### Enable Grouping

| Name             | Type    | Default | Description              |
| :--------------- | :------ | :------ | :----------------------- |
| `enableGrouping` | boolean | `false` | `Enable column grouping` |

##### Meta

Define further information about the column. Now `meta` is used to define `editable` columns.

| Name         | Type                                                            | Default     | Description                         |
| :----------- | :-------------------------------------------------------------- | :---------- | :---------------------------------- |
| `editable`   | boolean \| undefined                                            | `undefined` | `Enable rendering editable column`  |
| `template`   | JSX Element \| undefined                                        | `undefined` | `Enable rendering editable column`  |
| `updateData` | (rowIndex: number, id: string, value: any) => void \| undefined | `undefined` | `Callback to update table data`     |
| `revertData` | (rowIndex: number) => void \| undefined                         | `undefined` | `Callback to revert the table data` |

##### Example

```tsx
  {
    accessorFn: (row) => row.lastName,
    id: 'lastName',
    cell: (info) => info.getValue<string>(),
    header: () => <span>Last Name</span>,
    footer: (props) => props.column.id,
    enableResizing: true,
    enableColumnFilter: true,
    enableGrouping: true,
  },
```

#### Editable Cell

Press `ENTER` to finish editing the firstName cell, `Esc` to quit editing.

<section className={styles.componentShowcaseContainer}>
  <EditableCellTable />
</section>

Enable rendering customized template on top of the column cell.
Users can decide what to do with the template and update the table data.
To use this functionality:

- In the template component, use the hook `useEditableCellContext` that provides:

| Name                     | Type                  | Default | Description                                         |
| :----------------------- | :-------------------- | :------ | :-------------------------------------------------- |
| `cell`                   | `Cell<TData, TValue>` |         | `Cell object `                                      |
| `row`                    | `number`              |         | `row index`                                         |
| `column`                 | `string`              |         | `column name`                                       |
| `initialValue`           | `any`                 | —       | `cell initial value`                                |
| `finishTemplateEditing`  | `(data) => void`      | —       | `notify the table to call the update data function` |
| `cancelTemplateEditing ` | `(data) => void`      | —       | `notify the table to call the revert data function` |

- In the ColumnConfig object, define `editable = true` and `updateData` callback. If `template` is not defined, the default input will render.

```tsx
{
    accessorFn: (row) => row.lastName,
    id: 'lastName',
    cell: (info) => info.getValue<string>(),
    header: () => <span>Last Name</span>,
    footer: (props) => props.column.id,
    meta: {
      editable: true,
      updateData: (rowIndex: number, id: string, value: any) => {
        setData((old: Person[]) =>
          old.map((row, index) => {
            if (index === rowIndex) {
              return {
                ...old[rowIndex],
                [id]: value,
              } as Person
            }
            return row
          }),
        )
      },
    },
  },
```

#### Expandable Table Row

<section className={styles.componentShowcaseContainer}>
  <ExpandableColumnTable />
</section>

This feature allows users to display additional content to the table row.\
The `table-v2` component provides `renderRowSubComponent` props which is a callback with row data argument.\
In reality, users could pass whatever they want to the sub row including the entire
table instance. Users can also decide which column cell can be the row expander. Please take a look at the example for more details.

```tsx
const ExpandableColumnTable: React.FC = () => {
  const [data, setData] = React.useState(() => makeRequestStatusData(10))
  const [page, setPage] = useState(1)
  const options: ReactTableOptions<LimitRequestStatus> = {
    enableSorting: false,
    enableMultiSort: false,
    columnResizeMode: 'onChange',
    manualSorting: false,
  }

  const columns = React.useMemo<Array<ColumnConfig<LimitRequestStatus>>>(
    () => [
      {
        id: 'expander',
        size: 40,
        header: ({table}: HeaderContextProps<LimitRequestStatus, unknown>) => (
          <>
            <button
              {...{
                onClick: table.getToggleAllRowsExpandedHandler(),
              }}
            >
              {table.getIsAllRowsExpanded() ? (
                <Icon icon={faChevronDown} />
              ) : (
                <Icon icon={faChevronRight} />
              )}
            </button>{' '}
          </>
        ),
        cell: ({row}: CellContextProps<LimitRequestStatus, unknown>) => (
          <span
            onClick={() => row.toggleExpanded()}
            style={{
              cursor: 'pointer',
              userSelect: 'none',
              display: 'flex',
              justifyContent: 'center',
              alignItems: 'center',
            }}
          >
            {row.getIsExpanded() ? (
              <Icon icon={faChevronDown} />
            ) : (
              <Icon icon={faChevronRight} />
            )}
          </span>
        ),
      },
      {
        id: 'accountName',
        accessorKey: 'accountName',
        header: () => <div style={{textAlign: 'center'}}>Account Name</div>,
        footer: (props: HeaderContextProps<LimitRequestStatus, unknown>) =>
          props.column.id,
      },
      {
        id: 'code',
        accessorKey: 'code',
        header: () => <div style={{textAlign: 'center'}}>Code</div>,
        footer: (props: HeaderContextProps<LimitRequestStatus, unknown>) =>
          props.column.id,
      },
      {
        id: 'requestLimit',
        accessorKey: 'requestLimit',
        header: () => (
          <div style={{textAlign: 'center'}}>New Request Limit</div>
        ),
        footer: (props: HeaderContextProps<LimitRequestStatus, unknown>) =>
          props.column.id,
      },
      {
        id: 'status',
        accessorKey: 'status',
        header: () => <div style={{textAlign: 'center'}}>Status</div>,
        footer: (props: HeaderContextProps<LimitRequestStatus, unknown>) =>
          props.column.id,
      },
    ],
    [],
  )

  const renderRowSubComponent = (rowData: LimitRequestStatus) => {
    return (
      <div
        style={{
          padding: '1em',
          display: 'flex',
          flexDirection: 'column',
          rowGap: '1em',
        }}
      >
        <h3>Current Status: {rowData.status}</h3>
        <Divider />
        {rowData.progress?.map((processItem) => {
          return (
            <>
              <p style={{fontSize: '12px'}}>{processItem.remarks}</p>
              <p style={{fontSize: '11px', fontWeight: 200, color: '#878787'}}>
                {processItem.createdAt.toDateString()}
              </p>
              <Divider />
            </>
          )
        })}
      </div>
    )
  }
  return (
    <div>
      <ReactTable
        data={data}
        columns={columns}
        options={options}
        renderRowSubComponent={renderRowSubComponent}
      >
        <ReactTable.Footer
          css={{
            display: 'flex',
            flexDirection: 'row',
            justifyContent: 'space-between',
          }}
        >
          <div>{/* Todo: Dropdown */}</div>
          <div
            style={{
              display: 'flex',
              flexDirection: 'row',
              alignItems: 'center',
              gap: '0.5rem',
            }}
          >
            <div
              style={{
                fontWeight: '600',
              }}
            >
              {(page - 1) * 10 + 1} - {(page - 1) * 10 + 10} of 100
            </div>
            <Pagination
              page={page}
              onChange={(page: number) => setPage(page)}
              total={10}
            />
          </div>
        </ReactTable.Footer>
      </ReactTable>
    </div>
  )
}

type LimitRequestStatus = {
  id: string
  accountName: string
  code: string
  requestLimit: number
  status: string
  progress?: Progress[] | null
}

type Progress = {
  id: string
  remarks: string
  createdAt: Date
}
```

# Data Grid

The TableV2 component offers various features that enhance data visualization and user experience. For example, users can even draw chart within data-grid cell.

### Props

| Name                     | Type                                | Default | Description                     |
| :----------------------- | :---------------------------------- | :------ | :------------------------------ |
| `data`                   | Array                               | `[]`    | `Data for show.`                |
| `columns`                | `Array<ColumnDef<T>>`               | `[]`    | `column with custom config.`    |
| `options`                | OptionType                          | `{}`    | `Table option.`                 |
| `children`               | React.ReactNode                     | —       | `Child elements.`               |
| `css`                    | `CSS`                               | `{}`    | `Additional style.`             |
| `renderRowSubComponent ` | `(rowData: T) => React.JSX.Element` | —       | `Callback after expanding row.` |

---

<Callout>
  Check out our [ladle](/ladle?story=table-v2--full-featured) for more info on
  this component.
</Callout>
```
